import{_ as e,f as a,r as l,o as t,c as o,a as r,w as d,g as u,u as i,m as n,h as s,j as c,k as m,l as p,s as f,n as v,p as h,q as g,t as b,v as w,x as _,y,z as V,A as N,B as S,C,D as x,F as k,G as T,H as I,I as P,J as U,K as z,L as D,M as E,N as A,O as Y,P as M,Q as O,R as K,S as R,T as F}from"./_plugin-vue_export-helper-7955658d.js";const j={class:"dashboard"},B={class:"stat-content"},H={class:"stat-icon primary"},$=e({__name:"Dashboard",setup:e=>(a(()=>{}),(e,a)=>{const s=l("el-icon"),c=l("el-card"),m=l("el-col"),p=l("el-row");return t(),o("div",j,[r(p,{gutter:16,class:"stats-row"},{default:d(()=>[r(m,{xs:24,sm:12,lg:6},{default:d(()=>[r(c,{class:"stat-card",shadow:"hover"},{default:d(()=>[u("div",B,[u("div",H,[r(s,null,{default:d(()=>[r(i(n))]),_:1})]),a[0]||(a[0]=u("div",{class:"stat-info"},[u("div",{class:"stat-value"},"¥888,888.88"),u("div",{class:"stat-label"},"总用户余额")],-1))])]),_:1})]),_:1})]),_:1})])})},[["__scopeId","data-v-13894abe"]]),q={class:"customer-management"},L={class:"filter-line"},Q={class:"filter-line"},G={class:"filter-buttons"},X={class:"table-toolbar"},Z={class:"left"},J={style:{display:"flex","align-items":"center",gap:"8px"}},W={style:{"font-family":"monospace","font-size":"12px"}},ee={style:{display:"flex","align-items":"center",gap:"8px"}},ae={style:{"font-family":"monospace","font-size":"12px"}},le={style:{"line-height":"1.4"}},te={style:{"font-weight":"500",color:"var(--el-text-color-primary)"}},oe={style:{"font-size":"12px",color:"var(--el-text-color-regular)","margin-top":"2px"}},re={style:{color:"var(--el-color-primary)","font-weight":"500"}},de={class:"pagination-container"},ue={class:"dialog-footer"},ie={class:"edit-customer-content"},ne={class:"dialog-footer"},se={class:"amount-text"},ce={class:"amount-text"},me={class:"pagination-wrapper"},pe={class:"dialog-footer"},fe={class:"adjust-balance-form"},ve={class:"current-balance"},he={class:"value"},ge={class:"adjust-type"},be={class:"adjust-amount"},we={class:"result-balance"},_e={class:"value"},ye={class:"dialog-footer"},Ve={class:"product-config-content"},Ne={class:"customer-info"},Se={class:"product-config-section"},Ce={class:"section-header"},xe={class:"drawer-footer"},ke={class:"product-select-content"},Te={class:"dialog-footer"},Ie=e({__name:"CustomerManagement",setup(e){const z=s(!1);s(!1);const D=s([]),E=c({customerId:"",merchantNo:"",customerName:"",customerEmail:"",status:"",dateRange:[]}),A=s([{customerId:"1001",merchantNo:"M17408123456",merchantKey:"test_key_1234567890abcdef1234567890abcdef",aesKey:"aes_key_1234567890abcdef1234567890abcdef",customerName:"asd",customerEmail:"123@qq.com",balance:"9.900",status:"active",registerTime:"2025-02-25 00:28:27"},{customerId:"1002",merchantNo:"M17408234567",merchantKey:"test_key_abcdef1234567890abcdef1234567890",aesKey:"aes_key_fedcba0987654321fedcba0987654321",customerName:"aaa",customerEmail:"888@gmail.com",balance:"0.000",status:"active",registerTime:"2025-02-25 17:55:35"},{customerId:"1003",merchantNo:"M17408345678",merchantKey:"test_key_9876543210fedcba9876543210fedcba",aesKey:"aes_key_abcd1234efgh5678ijkl9012mnop3456",customerName:"bbb",customerEmail:"999@gmail.com",balance:"0.000",status:"disabled",registerTime:"2025-02-25 18:09:00"}]),Y=c({currentPage:1,pageSize:10,total:3}),M=s(!1),O=s(),K=c({merchantNo:"",merchantKey:"",aesKey:"",customerName:"",customerEmail:"",balance:""}),R={merchantNo:[{required:!0,message:"商户号不能为空",trigger:"blur"}],merchantKey:[{required:!0,message:"商户密钥不能为空",trigger:"blur"}],customerName:[{required:!0,message:"请输入客户昵称",trigger:"blur"}],customerEmail:[{required:!0,message:"请输入客户邮箱",trigger:"blur"}]},F=s(!1),j=s(),B=s(!1),H=c({customerId:"",customerName:"",customerEmail:"",balance:"",merchantNo:"",merchantKey:"",aesKey:"",status:"active"}),$={customerName:[{required:!0,message:"请输入客户昵称",trigger:"blur"}],customerEmail:[{required:!0,message:"请输入客户邮箱",trigger:"blur"}]},Ie=s(!1),Pe=s([{operator:"admin",editTime:"2025-02-25 14:32:33",amount:-.1,beforeAmount:10,afterAmount:9.9,flowType:"交易扣减",type:"TK202502251432001"},{operator:"manager",editTime:"2025-02-25 00:28:27",amount:10,beforeAmount:0,afterAmount:10,flowType:"人工修改",type:""},{operator:"admin",editTime:"2025-02-24 16:45:12",amount:50,beforeAmount:25,afterAmount:75,flowType:"人工修改",type:""},{operator:"",editTime:"2025-02-24 10:20:15",amount:-25,beforeAmount:50,afterAmount:25,flowType:"交易扣减",type:"TK202502241020002"}]),Ue=s({flowType:""}),ze=m(()=>Ue.value.flowType?Pe.value.filter(e=>e.flowType===Ue.value.flowType):Pe.value),De=()=>{},Ee=c({currentPage:1,pageSize:10,total:2}),Ae=s(!1),Ye=s("9.900"),Me=s("increase"),Oe=s(""),Ke=m(()=>{const e=parseFloat(Ye.value)||0,a=parseFloat(Oe.value)||0;return"increase"===Me.value?(e+a).toFixed(3):(e-a).toFixed(3)}),Re=s(!1),Fe=s(!1),je=s(!1),Be=s({}),He=s([10,20,50,100,200,300]),$e=s([]),qe=s(!1),Le=s([]),Qe=s([]),Ge=s(!1),Xe=e=>{D.value=e},Ze=()=>{M.value=!0,Object.assign(K,{merchantNo:"",merchantKey:"",aesKey:"",customerName:"",customerEmail:"",balance:""}),(()=>{const e=Date.now().toString(),a=Math.floor(1e3*Math.random()).toString().padStart(3,"0");K.merchantNo=`M${e.slice(-8)}${a}`})(),(()=>{const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let a="merchant_key_";for(let l=0;l<32;l++)a+=e.charAt(Math.floor(62*Math.random()));K.merchantKey=a})(),(()=>{const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let a="aes_key_";for(let l=0;l<32;l++)a+=e.charAt(Math.floor(62*Math.random()));K.aesKey=a})()},Je=async()=>{try{await O.value.validate(),P.success("新增客户成功"),M.value=!1}catch(e){}},We=async()=>{try{await j.value.validate(),B.value=!0,await new Promise(e=>setTimeout(e,1e3)),P.success("客户信息修改成功"),F.value=!1}catch(e){!1!==e&&P.error("修改失败，请重试")}finally{B.value=!1}},ea=e=>{U.confirm(`确认重置客户 "${e.customerName}" 的商户密钥和AES密钥吗？重置后原密钥将失效。`,"重置密钥确认",{confirmButtonText:"确认重置",cancelButtonText:"取消",type:"warning"}).then(()=>{const a="merchant_key_"+Math.random().toString(36).substr(2,32),l="aes_key_"+Math.random().toString(36).substr(2,32),t=A.value.findIndex(a=>a.customerId===e.customerId);-1!==t&&(A.value[t].merchantKey=a,A.value[t].aesKey=l),U.alert(`新密钥已生成，请妥善保管：\n商户密钥：${a}\nAES密钥：${l}`,"密钥重置成功",{confirmButtonText:"我已保存",type:"success",showClose:!1,closeOnClickModal:!1,closeOnPressEscape:!1}).then(()=>{(async()=>{z.value=!0;try{await new Promise(e=>setTimeout(e,500)),P.success("数据已刷新")}finally{z.value=!1}})()}),P.success("商户密钥和AES密钥重置成功")}).catch(()=>{P.info("已取消重置")})},aa=(e,a)=>{switch(e){case"edit":(e=>{F.value=!0,Object.assign(H,{customerId:e.customerId,customerName:e.customerName,customerEmail:e.customerEmail,balance:e.balance,merchantNo:e.merchantNo,merchantKey:e.merchantKey,aesKey:e.aesKey,status:e.status||"active"})})(a);break;case"productConfig":la(a);break;case"balance":sa();break;case"adjustBalance":ca(a);break;case"resetKey":ea(a);break;case"delete":(e=>{U.confirm(`确定要删除客户 ${e.customerName} 吗？`,"删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{P.success("删除成功")})})(a)}},la=e=>{Be.value={customerId:e.customerId,customerName:e.customerName,merchantNo:e.merchantNo,customerEmail:e.customerEmail},Re.value=!0,ta(e.customerId)},ta=async e=>{Fe.value=!0;try{await new Promise(e=>setTimeout(e,500))}catch(a){P.error("加载产品配置失败")}finally{Fe.value=!1}},oa=async()=>{qe.value=!0,await ra(),Le.value=[]},ra=async()=>{Ge.value=!0;try{await new Promise(e=>setTimeout(e,500));const e=[{productId:"PD1001",productName:"产品A",faceValue:"10"},{productId:"PD1002",productName:"产品B",faceValue:"20"},{productId:"PD1003",productName:"产品C",faceValue:"50"},{productId:"PD1004",productName:"产品D",faceValue:"20"},{productId:"PD1005",productName:"产品E",faceValue:"50"}];Qe.value=e}catch(e){P.error("获取产品数据失败")}finally{Ge.value=!1}},da=()=>{Re.value=!1,Be.value={}},ua=()=>{qe.value=!1,Le.value=[]},ia=()=>{0!==Le.value.length?(Le.value.forEach(e=>{const a=Qe.value.find(a=>a.productId===e);if(a){const e={id:Date.now()+Math.random(),productCode:a.productId,productName:a.productName,faceValue:"",discountRate:""};$e.value.push(e)}}),P.success(`成功添加 ${Le.value.length} 个产品配置`),qe.value=!1,Le.value=[]):P.warning("请至少选择一个产品")},na=async()=>{for(let a=0;a<$e.value.length;a++){const e=$e.value[a];if(!e.faceValue||""===e.faceValue)return void P.error(`${e.productName} 请选择面值`);if(!e.discountRate||""===e.discountRate)return void P.error(`${e.productName} 请输入折扣比例`)}je.value=!0;try{await new Promise(e=>setTimeout(e,1e3)),P.success("产品配置保存成功"),Re.value=!1}catch(e){P.error("保存失败，请重试")}finally{je.value=!1}},sa=e=>{Ie.value=!0},ca=e=>{Ae.value=!0,Ye.value=e?e.balance:H.balance,Me.value="increase",Oe.value=""},ma=()=>{P.success("余额调整成功"),H.balance=Ke.value,Ae.value=!1},pa=e=>{Y.pageSize=e},fa=e=>{Y.currentPage=e};return a(()=>{}),(e,a)=>{const s=l("el-input"),c=l("el-form-item"),m=l("el-option"),U=l("el-select"),D=l("el-date-picker"),Pe=l("el-icon"),ea=l("el-button"),la=l("el-form"),ta=l("el-card"),ra=l("el-table-column"),sa=l("el-tag"),ca=l("el-dropdown-item"),va=l("el-dropdown-menu"),ha=l("el-dropdown"),ga=l("el-table"),ba=l("el-pagination"),wa=l("el-dialog"),_a=l("el-switch"),ya=l("el-radio"),Va=l("el-radio-group"),Na=l("el-descriptions-item"),Sa=l("el-descriptions"),Ca=l("el-input-number"),xa=l("el-drawer"),ka=p("loading");return t(),o("div",q,[r(ta,{shadow:"never",class:"filter-container"},{default:d(()=>[r(la,{model:E,class:"multi-line-filter-form"},{default:d(()=>[u("div",L,[r(c,{label:"客户ID：",prop:"customerId"},{default:d(()=>[r(s,{modelValue:E.customerId,"onUpdate:modelValue":a[0]||(a[0]=e=>E.customerId=e),placeholder:"请输入客户ID",clearable:"",style:{width:"180px"}},null,8,["modelValue"])]),_:1}),r(c,{label:"商户号：",prop:"merchantNo"},{default:d(()=>[r(s,{modelValue:E.merchantNo,"onUpdate:modelValue":a[1]||(a[1]=e=>E.merchantNo=e),placeholder:"请输入商户号",clearable:"",style:{width:"180px"}},null,8,["modelValue"])]),_:1}),r(c,{label:"昵称：",prop:"customerName"},{default:d(()=>[r(s,{modelValue:E.customerName,"onUpdate:modelValue":a[2]||(a[2]=e=>E.customerName=e),placeholder:"请输入客户昵称",clearable:"",style:{width:"180px"}},null,8,["modelValue"])]),_:1}),r(c,{label:"邮箱：",prop:"customerEmail"},{default:d(()=>[r(s,{modelValue:E.customerEmail,"onUpdate:modelValue":a[3]||(a[3]=e=>E.customerEmail=e),placeholder:"请输入客户邮箱",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1})]),u("div",Q,[r(c,{label:"状态：",prop:"status"},{default:d(()=>[r(U,{modelValue:E.status,"onUpdate:modelValue":a[4]||(a[4]=e=>E.status=e),placeholder:"请选择状态",clearable:"",style:{width:"140px"}},{default:d(()=>[r(m,{label:"启用",value:"active"}),r(m,{label:"禁用",value:"inactive"})]),_:1},8,["modelValue"])]),_:1}),r(c,{label:"注册时间：",prop:"registerTimeRange"},{default:d(()=>[r(D,{modelValue:E.registerTimeRange,"onUpdate:modelValue":a[5]||(a[5]=e=>E.registerTimeRange=e),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"240px"}},null,8,["modelValue"])]),_:1}),u("div",G,[r(ea,{type:"primary",onClick:e.handleFilter},{default:d(()=>[r(Pe,null,{default:d(()=>[r(i(f))]),_:1}),a[38]||(a[38]=v(" 查询 ",-1))]),_:1},8,["onClick"]),r(ea,{plain:"",onClick:e.resetFilter},{default:d(()=>[r(Pe,null,{default:d(()=>[r(i(h))]),_:1}),a[39]||(a[39]=v(" 重置 ",-1))]),_:1},8,["onClick"])])])]),_:1},8,["model"])]),_:1}),r(ta,null,{default:d(()=>[u("div",X,[u("div",Z,[r(ea,{type:"primary",onClick:Ze},{default:d(()=>[r(Pe,null,{default:d(()=>[r(i(g))]),_:1}),a[40]||(a[40]=v(" 新增客户 ",-1))]),_:1})])]),b((t(),w(ga,{data:A.value,border:"",stripe:"",onSelectionChange:Xe,style:{width:"100%"}},{default:d(()=>[r(ra,{type:"selection",width:"55"}),r(ra,{prop:"customerId",label:"客户ID",width:"100","show-overflow-tooltip":""}),r(ra,{prop:"merchantNo",label:"商户号",width:"160","show-overflow-tooltip":""}),r(ra,{prop:"merchantKey",label:"商户密钥",width:"240","show-overflow-tooltip":""},{default:d(({row:e})=>[u("div",J,[u("span",W,_(e.merchantKey),1),r(ea,{type:"primary",link:"",size:"small",onClick:a=>(async e=>{try{await navigator.clipboard.writeText(e),P.success("商户密钥已复制到剪贴板")}catch(a){P.error("复制失败，请手动复制")}})(e.merchantKey)},{default:d(()=>[r(Pe,null,{default:d(()=>[r(i(y))]),_:1})]),_:2},1032,["onClick"])])]),_:1}),r(ra,{prop:"aesKey",label:"AES密钥",width:"240","show-overflow-tooltip":""},{default:d(({row:e})=>[u("div",ee,[u("span",ae,_(e.aesKey),1),r(ea,{type:"primary",link:"",size:"small",onClick:a=>(async e=>{try{await navigator.clipboard.writeText(e),P.success("AES密钥已复制到剪贴板")}catch(a){P.error("复制失败，请手动复制")}})(e.aesKey)},{default:d(()=>[r(Pe,null,{default:d(()=>[r(i(y))]),_:1})]),_:2},1032,["onClick"])])]),_:1}),r(ra,{label:"客户信息",width:"220","show-overflow-tooltip":""},{default:d(({row:e})=>[u("div",le,[u("div",te,_(e.customerName),1),u("div",oe,_(e.customerEmail),1)])]),_:1}),r(ra,{prop:"balance",label:"余额",width:"120",sortable:"",align:"right"},{default:d(({row:e})=>[u("span",re,"¥"+_(parseFloat(e.balance).toLocaleString()),1)]),_:1}),r(ra,{prop:"status",label:"状态",width:"80",align:"center"},{default:d(({row:e})=>[r(sa,{type:"active"===e.status?"success":"danger"},{default:d(()=>[v(_("active"===e.status?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),r(ra,{label:"商户后台",width:"110",align:"center"},{default:d(({row:e})=>[r(ea,{link:"",type:"primary",onClick:a=>(e=>{const a=new URLSearchParams({merchantNo:e.merchantNo,merchantKey:e.merchantKey,customerName:e.customerName,customerId:e.customerId});window.open(`/merchant?${a.toString()}`,"_blank"),P.success(`正在进入 ${e.customerName} 的商户后台系统`)})(e)},{default:d(()=>[r(Pe,null,{default:d(()=>[r(i(V))]),_:1}),a[41]||(a[41]=v(" 进入后台 ",-1))]),_:2},1032,["onClick"])]),_:1}),r(ra,{prop:"registerTime",label:"注册时间",width:"160",sortable:""}),r(ra,{label:"操作",width:"120",fixed:"right",align:"center"},{default:d(({row:e})=>[r(ha,{trigger:"click",onCommand:a=>aa(a,e)},{dropdown:d(()=>[r(va,null,{default:d(()=>[r(ca,{command:"edit"},{default:d(()=>[r(Pe,null,{default:d(()=>[r(i(N))]),_:1}),a[43]||(a[43]=v(" 编辑 ",-1))]),_:1}),r(ca,{command:"adjustBalance"},{default:d(()=>[r(Pe,null,{default:d(()=>[r(i(N))]),_:1}),a[44]||(a[44]=v(" 余额操作 ",-1))]),_:1}),r(ca,{command:"balance"},{default:d(()=>[r(Pe,null,{default:d(()=>[r(i(n))]),_:1}),a[45]||(a[45]=v(" 余额详情 ",-1))]),_:1}),r(ca,{command:"productConfig"},{default:d(()=>[r(Pe,null,{default:d(()=>[r(i(S))]),_:1}),a[46]||(a[46]=v(" 产品配置 ",-1))]),_:1}),r(ca,{command:"resetKey"},{default:d(()=>[r(Pe,null,{default:d(()=>[r(i(h))]),_:1}),a[47]||(a[47]=v(" 重置密钥 ",-1))]),_:1}),r(ca,{command:"delete",divided:""},{default:d(()=>[r(Pe,null,{default:d(()=>[r(i(C))]),_:1}),a[48]||(a[48]=u("span",{style:{color:"var(--el-color-danger)"}},"删除",-1))]),_:1})]),_:1})]),default:d(()=>[r(ea,{text:"",type:"primary",style:{"font-size":"14px"}},{default:d(()=>[a[42]||(a[42]=v(" 操作 ",-1)),r(Pe,{class:"el-icon--right"},{default:d(()=>[r(i(x))]),_:1})]),_:1})]),_:2},1032,["onCommand"])]),_:1})]),_:1},8,["data"])),[[ka,z.value]]),u("div",de,[r(ba,{"current-page":Y.currentPage,"onUpdate:currentPage":a[6]||(a[6]=e=>Y.currentPage=e),"page-size":Y.pageSize,"onUpdate:pageSize":a[7]||(a[7]=e=>Y.pageSize=e),"page-sizes":[10,20,50,100],total:Y.total,layout:"total, sizes, prev, pager, next",onSizeChange:pa,onCurrentChange:fa},null,8,["current-page","page-size","total"])])]),_:1}),r(wa,{modelValue:M.value,"onUpdate:modelValue":a[15]||(a[15]=e=>M.value=e),title:"新增客户",width:"500px"},{footer:d(()=>[u("div",ue,[r(ea,{onClick:a[14]||(a[14]=e=>M.value=!1)},{default:d(()=>[...a[50]||(a[50]=[v("取消",-1)])]),_:1}),r(ea,{type:"primary",onClick:Je},{default:d(()=>[...a[51]||(a[51]=[v("确定",-1)])]),_:1})])]),default:d(()=>[r(la,{ref_key:"addFormRef",ref:O,model:K,rules:R,"label-width":"100px","label-position":"right"},{default:d(()=>[r(c,{label:"商户号",prop:"merchantNo"},{default:d(()=>[r(s,{modelValue:K.merchantNo,"onUpdate:modelValue":a[8]||(a[8]=e=>K.merchantNo=e),placeholder:"系统自动生成",readonly:"",disabled:"",style:{"background-color":"var(--el-fill-color-light)"}},null,8,["modelValue"])]),_:1}),r(c,{label:"商户密钥",prop:"merchantKey"},{default:d(()=>[r(s,{modelValue:K.merchantKey,"onUpdate:modelValue":a[9]||(a[9]=e=>K.merchantKey=e),placeholder:"系统自动生成",readonly:"",disabled:"",style:{"background-color":"var(--el-fill-color-light)"}},null,8,["modelValue"])]),_:1}),r(c,{label:"AES密钥",prop:"aesKey"},{default:d(()=>[r(s,{modelValue:K.aesKey,"onUpdate:modelValue":a[10]||(a[10]=e=>K.aesKey=e),placeholder:"系统自动生成",readonly:"",disabled:"",style:{"background-color":"var(--el-fill-color-light)"}},null,8,["modelValue"])]),_:1}),r(c,{label:"客户昵称",prop:"customerName"},{default:d(()=>[r(s,{modelValue:K.customerName,"onUpdate:modelValue":a[11]||(a[11]=e=>K.customerName=e),placeholder:"请输入客户昵称",clearable:""},null,8,["modelValue"])]),_:1}),r(c,{label:"客户邮箱",prop:"customerEmail"},{default:d(()=>[r(s,{modelValue:K.customerEmail,"onUpdate:modelValue":a[12]||(a[12]=e=>K.customerEmail=e),placeholder:"请输入客户邮箱",clearable:""},null,8,["modelValue"])]),_:1}),r(c,{label:"客户余额",prop:"balance"},{default:d(()=>[r(s,{modelValue:K.balance,"onUpdate:modelValue":a[13]||(a[13]=e=>K.balance=e),placeholder:"请输入初始余额",clearable:""},{append:d(()=>[...a[49]||(a[49]=[v("元",-1)])]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),r(wa,{modelValue:F.value,"onUpdate:modelValue":a[24]||(a[24]=e=>F.value=e),title:"编辑客户信息",width:"600px","close-on-click-modal":!1},{footer:d(()=>[u("div",ne,[r(ea,{onClick:a[23]||(a[23]=e=>F.value=!1)},{default:d(()=>[...a[52]||(a[52]=[v("取消",-1)])]),_:1}),r(ea,{type:"primary",onClick:We,loading:B.value},{default:d(()=>[...a[53]||(a[53]=[v(" 保存修改 ",-1)])]),_:1},8,["loading"])])]),default:d(()=>[u("div",ie,[r(la,{ref_key:"editFormRef",ref:j,model:H,rules:$,"label-width":"100px","label-position":"right"},{default:d(()=>[r(c,{label:"客户ID"},{default:d(()=>[r(s,{modelValue:H.customerId,"onUpdate:modelValue":a[16]||(a[16]=e=>H.customerId=e),disabled:"",style:{"background-color":"var(--el-fill-color-light)"}},null,8,["modelValue"])]),_:1}),r(c,{label:"商户号"},{default:d(()=>[r(s,{modelValue:H.merchantNo,"onUpdate:modelValue":a[17]||(a[17]=e=>H.merchantNo=e),disabled:"",style:{"background-color":"var(--el-fill-color-light)"}},null,8,["modelValue"])]),_:1}),r(c,{label:"商户密钥"},{default:d(()=>[r(s,{modelValue:H.merchantKey,"onUpdate:modelValue":a[18]||(a[18]=e=>H.merchantKey=e),disabled:"",style:{"background-color":"var(--el-fill-color-light)"},type:"password","show-password":""},null,8,["modelValue"])]),_:1}),r(c,{label:"AES密钥"},{default:d(()=>[r(s,{modelValue:H.aesKey,"onUpdate:modelValue":a[19]||(a[19]=e=>H.aesKey=e),disabled:"",style:{"background-color":"var(--el-fill-color-light)"},type:"password","show-password":""},null,8,["modelValue"])]),_:1}),r(c,{label:"客户昵称",prop:"customerName"},{default:d(()=>[r(s,{modelValue:H.customerName,"onUpdate:modelValue":a[20]||(a[20]=e=>H.customerName=e),placeholder:"请输入客户昵称",clearable:"","prefix-icon":i(N)},null,8,["modelValue","prefix-icon"])]),_:1}),r(c,{label:"客户邮箱",prop:"customerEmail"},{default:d(()=>[r(s,{modelValue:H.customerEmail,"onUpdate:modelValue":a[21]||(a[21]=e=>H.customerEmail=e),placeholder:"请输入客户邮箱",clearable:"",type:"email"},null,8,["modelValue"])]),_:1}),r(c,{label:"状态"},{default:d(()=>[r(_a,{modelValue:H.status,"onUpdate:modelValue":a[22]||(a[22]=e=>H.status=e),"active-text":"启用","inactive-text":"禁用","active-value":"active","inactive-value":"inactive",style:{"--el-switch-on-color":"var(--el-color-primary)","--el-switch-off-color":"var(--el-color-info)"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])])]),_:1},8,["modelValue"]),r(wa,{modelValue:Ie.value,"onUpdate:modelValue":a[30]||(a[30]=e=>Ie.value=e),title:"余额详情",width:"900px"},{footer:d(()=>[u("div",pe,[r(ea,{onClick:a[28]||(a[28]=e=>Ie.value=!1)},{default:d(()=>[...a[54]||(a[54]=[v("取消",-1)])]),_:1}),r(ea,{type:"primary",onClick:a[29]||(a[29]=e=>Ie.value=!1)},{default:d(()=>[...a[55]||(a[55]=[v("确定",-1)])]),_:1})])]),default:d(()=>[r(ta,{shadow:"never",class:"balance-filter-container"},{default:d(()=>[r(la,{model:Ue.value,inline:""},{default:d(()=>[r(c,{label:"流水类型：",prop:"flowType"},{default:d(()=>[r(U,{modelValue:Ue.value.flowType,"onUpdate:modelValue":a[25]||(a[25]=e=>Ue.value.flowType=e),placeholder:"请选择流水类型",clearable:"",style:{width:"150px"},onChange:De},{default:d(()=>[r(m,{label:"全部",value:""}),r(m,{label:"人工修改",value:"人工修改"}),r(m,{label:"交易扣减",value:"交易扣减"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1}),r(ga,{data:ze.value,border:"",stripe:""},{default:d(()=>[r(ra,{prop:"flowType",label:"流水类型",width:"120"},{default:d(({row:e})=>[r(sa,{type:"人工修改"===e.flowType?"primary":"warning"},{default:d(()=>[v(_(e.flowType),1)]),_:2},1032,["type"])]),_:1}),r(ra,{prop:"beforeAmount",label:"交易前金额",width:"120"},{default:d(({row:e})=>[u("span",se,_(e.beforeAmount),1)]),_:1}),r(ra,{prop:"amount",label:"变动金额",width:"120"},{default:d(({row:e})=>[u("span",{class:k(e.amount>0?"amount-positive":"amount-negative")},_(e.amount>0?"+":"")+_(e.amount),3)]),_:1}),r(ra,{prop:"afterAmount",label:"变动后金额",width:"120"},{default:d(({row:e})=>[u("span",ce,_(e.afterAmount),1)]),_:1}),r(ra,{prop:"operator",label:"操作人",width:"120"},{default:d(({row:e})=>[u("span",null,_("交易扣减"===e.flowType?"":e.operator),1)]),_:1}),r(ra,{prop:"type",label:"备注","min-width":"200"},{default:d(({row:e})=>[u("span",null,_("人工修改"===e.flowType?"":"交易扣减"===e.flowType?"提卡单号":e.type),1)]),_:1}),r(ra,{prop:"editTime",label:"修改时间",width:"180"})]),_:1},8,["data"]),u("div",me,[r(ba,{"current-page":Ee.currentPage,"onUpdate:currentPage":a[26]||(a[26]=e=>Ee.currentPage=e),"page-size":Ee.pageSize,"onUpdate:pageSize":a[27]||(a[27]=e=>Ee.pageSize=e),"page-sizes":[10,20,50],total:Ee.total,layout:"total, sizes, prev, pager, next"},null,8,["current-page","page-size","total"])])]),_:1},8,["modelValue"]),r(wa,{modelValue:Ae.value,"onUpdate:modelValue":a[34]||(a[34]=e=>Ae.value=e),title:"余额调整",width:"500px"},{footer:d(()=>[u("div",ye,[r(ea,{onClick:a[33]||(a[33]=e=>Ae.value=!1)},{default:d(()=>[...a[63]||(a[63]=[v("取消",-1)])]),_:1}),r(ea,{type:"primary",onClick:ma},{default:d(()=>[...a[64]||(a[64]=[v("确定",-1)])]),_:1})])]),default:d(()=>[u("div",fe,[u("div",ve,[a[56]||(a[56]=u("span",{class:"label"},"当前余额:",-1)),u("span",he,_(Ye.value)+"元",1)]),u("div",ge,[a[59]||(a[59]=u("span",{class:"label"},"余额增减:",-1)),r(Va,{modelValue:Me.value,"onUpdate:modelValue":a[31]||(a[31]=e=>Me.value=e)},{default:d(()=>[r(ya,{value:"increase"},{default:d(()=>[...a[57]||(a[57]=[v("余额增加",-1)])]),_:1}),r(ya,{value:"decrease"},{default:d(()=>[...a[58]||(a[58]=[v("余额减少",-1)])]),_:1})]),_:1},8,["modelValue"])]),u("div",be,[a[61]||(a[61]=u("span",{class:"label"},"修改数额:",-1)),r(s,{modelValue:Oe.value,"onUpdate:modelValue":a[32]||(a[32]=e=>Oe.value=e),placeholder:"请输入",style:{width:"200px"},clearable:""},{append:d(()=>[...a[60]||(a[60]=[v("元",-1)])]),_:1},8,["modelValue"])]),u("div",we,[a[62]||(a[62]=u("span",{class:"label"},"修改后余额:",-1)),u("span",_e,_(Ke.value)+"元",1)])])]),_:1},8,["modelValue"]),r(xa,{modelValue:Re.value,"onUpdate:modelValue":a[35]||(a[35]=e=>Re.value=e),title:"产品配置",direction:"rtl",size:"60%","before-close":da},{footer:d(()=>[u("div",xe,[r(ea,{onClick:da},{default:d(()=>[...a[69]||(a[69]=[v("取消",-1)])]),_:1}),r(ea,{type:"primary",onClick:na,loading:je.value},{default:d(()=>[...a[70]||(a[70]=[v(" 保存配置 ",-1)])]),_:1},8,["loading"])])]),default:d(()=>[u("div",Ve,[u("div",Ne,[a[65]||(a[65]=u("h4",null,"客户信息",-1)),r(Sa,{column:2,border:""},{default:d(()=>[r(Na,{label:"客户ID"},{default:d(()=>[v(_(Be.value.customerId),1)]),_:1}),r(Na,{label:"客户昵称"},{default:d(()=>[v(_(Be.value.customerName),1)]),_:1}),r(Na,{label:"商户号"},{default:d(()=>[v(_(Be.value.merchantNo),1)]),_:1}),r(Na,{label:"客户邮箱"},{default:d(()=>[v(_(Be.value.customerEmail),1)]),_:1})]),_:1})]),u("div",Se,[u("div",Ce,[a[67]||(a[67]=u("h4",null,"卡密产品配置",-1)),r(ea,{type:"primary",icon:i(g),onClick:oa},{default:d(()=>[...a[66]||(a[66]=[v(" 新增产品 ",-1)])]),_:1},8,["icon"])]),b((t(),w(ga,{data:$e.value,border:"",stripe:""},{default:d(()=>[r(ra,{prop:"productCode",label:"产品编码",width:"120"}),r(ra,{prop:"productName",label:"产品名称","min-width":"150"}),r(ra,{label:"面值",width:"160",align:"center"},{default:d(({row:e})=>[r(U,{modelValue:e.faceValue,"onUpdate:modelValue":a=>e.faceValue=a,placeholder:"选择面值",size:"small",style:{width:"100px"},onChange:e=>{}},{default:d(()=>[(t(!0),o(T,null,I(He.value,e=>(t(),w(m,{key:e,label:`¥${e}`,value:e},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),r(ra,{label:"折扣比例",width:"180",align:"center"},{default:d(({row:e})=>[r(Ca,{modelValue:e.discountRate,"onUpdate:modelValue":a=>e.discountRate=a,min:0,step:.01,precision:2,placeholder:"请输入",size:"small",style:{width:"120px"},onChange:e=>{}},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),r(ra,{label:"操作",width:"100",align:"center"},{default:d(({row:e,$index:l})=>[r(ea,{type:"danger",link:"",icon:i(C),onClick:e=>{return a=l,void($e.value.length<=1?P.warning("至少需要保留一个产品配置"):($e.value.splice(a,1),P.success("产品配置已删除")));var a},size:"small"},{default:d(()=>[...a[68]||(a[68]=[v(" 删除 ",-1)])]),_:2},1032,["icon","onClick"])]),_:1})]),_:1},8,["data"])),[[ka,Fe.value]])])])]),_:1},8,["modelValue"]),r(wa,{modelValue:qe.value,"onUpdate:modelValue":a[37]||(a[37]=e=>qe.value=e),title:"选择产品",width:"500px","before-close":ua},{footer:d(()=>[u("div",Te,[r(ea,{onClick:ua},{default:d(()=>[...a[71]||(a[71]=[v("取消",-1)])]),_:1}),r(ea,{type:"primary",onClick:ia,disabled:0===Le.value.length},{default:d(()=>[v(" 确认选择 ("+_(Le.value.length)+") ",1)]),_:1},8,["disabled"])])]),default:d(()=>[u("div",ke,[r(la,{"label-width":"80px"},{default:d(()=>[r(c,{label:"选择产品："},{default:d(()=>[r(U,{modelValue:Le.value,"onUpdate:modelValue":a[36]||(a[36]=e=>Le.value=e),multiple:"",filterable:"",placeholder:"请选择产品",style:{width:"100%"},loading:Ge.value},{default:d(()=>[(t(!0),o(T,null,I(Qe.value,e=>(t(),w(m,{key:e.productId,label:e.productName,value:e.productId},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1})]),_:1})])]),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-15542a58"]]),Pe={class:"product-management"},Ue={class:"filter-line"},ze={class:"filter-line"},De={class:"filter-buttons"},Ee={class:"table-toolbar"},Ae={class:"left"},Ye={class:"operation-buttons"},Me={class:"pagination-container"},Oe={class:"dialog-footer"},Ke={class:"dialog-footer"},Re=e({__name:"CardManagement",setup(e){const n=s(!1),m=s(!1),y=c({productId:"",productName:""}),V=s([{productId:"PD1001",productName:"电话卡套餐A",faceValue:"10",productLink:"xxxxxx",soldCount:"1 / 1",createTime:"2025-02-25 14:32:33"},{productId:"PD1002",productName:"流量卡套餐B",faceValue:"20",productLink:"www.baidu.com",soldCount:"0 / 100",createTime:"2025-02-25 18:08:34"},{productId:"PD1003",productName:"游戏卡套餐C",faceValue:"50",productLink:"www",soldCount:"0 / 100",createTime:"2025-02-25 18:09:54"}]),S=c({currentPage:1,pageSize:10,total:3}),x=s(!1),k=s(),T=c({productName:""}),I={productName:[{required:!0,message:"请输入产品名称",trigger:"blur"}]},U=s(!1),z=s(),D=c({productId:"",productName:""}),E={productName:[{required:!0,message:"请输入产品名称",trigger:"blur"}]},A=()=>{},Y=()=>{Object.assign(y,{productId:"",productName:""})},M=()=>{x.value=!0,Object.assign(T,{productName:""})},O=async()=>{try{await k.value.validate(),P.success("新建产品成功"),x.value=!1}catch(e){}},K=async()=>{try{await z.value.validate(),P.success("编辑产品成功"),U.value=!1}catch(e){}},R=e=>{S.pageSize=e},F=e=>{S.currentPage=e};return a(()=>{}),(e,a)=>{const s=l("el-input"),c=l("el-form-item"),j=l("el-icon"),B=l("el-button"),H=l("el-form"),$=l("el-card"),q=l("el-table-column"),L=l("el-popconfirm"),Q=l("el-table"),G=l("el-pagination"),X=l("el-divider"),Z=l("el-dialog"),J=p("loading");return t(),o("div",Pe,[r($,{shadow:"never",class:"filter-container"},{default:d(()=>[r(H,{model:y,class:"multi-line-filter-form"},{default:d(()=>[u("div",Ue,[r(c,{label:"产品编码：",prop:"productId"},{default:d(()=>[r(s,{modelValue:y.productId,"onUpdate:modelValue":a[0]||(a[0]=e=>y.productId=e),placeholder:"请输入产品编码",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),r(c,{label:"产品名称：",prop:"productName"},{default:d(()=>[r(s,{modelValue:y.productName,"onUpdate:modelValue":a[1]||(a[1]=e=>y.productName=e),placeholder:"请输入产品名称",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1})]),u("div",ze,[u("div",De,[r(B,{type:"primary",onClick:A,loading:m.value},{default:d(()=>[r(j,null,{default:d(()=>[r(i(f))]),_:1}),a[11]||(a[11]=v(" 查询 ",-1))]),_:1},8,["loading"]),r(B,{plain:"",onClick:Y},{default:d(()=>[r(j,null,{default:d(()=>[r(i(h))]),_:1}),a[12]||(a[12]=v(" 重置 ",-1))]),_:1})])])]),_:1},8,["model"])]),_:1}),r($,null,{default:d(()=>[u("div",Ee,[u("div",Ae,[r(B,{type:"primary",icon:i(g),onClick:M},{default:d(()=>[...a[13]||(a[13]=[v("新建产品",-1)])]),_:1},8,["icon"])])]),b((t(),w(Q,{data:V.value,style:{width:"100%"}},{default:d(()=>[r(q,{prop:"productId",label:"产品编码",width:"120"}),r(q,{prop:"productName",label:"产品名称","min-width":"150"},{default:d(({row:e,$index:a})=>[u("span",null,"产品"+_(String.fromCharCode(65+a)),1)]),_:1}),r(q,{prop:"createTime",label:"创建时间",width:"160"}),r(q,{label:"操作",width:"160",fixed:"right"},{default:d(({row:e})=>[u("div",Ye,[r(B,{link:"",type:"primary",icon:i(N),onClick:a=>(e=>{U.value=!0,Object.assign(D,{productId:e.productId,productName:e.productName})})(e)},{default:d(()=>[...a[14]||(a[14]=[v("编辑",-1)])]),_:2},1032,["icon","onClick"]),r(L,{title:"请解绑所有关联此产品的商户后操作",onConfirm:e=>{P.success("删除成功")}},{reference:d(()=>[r(B,{link:"",type:"danger",icon:i(C)},{default:d(()=>[...a[15]||(a[15]=[v("删除",-1)])]),_:1},8,["icon"])]),_:2},1032,["onConfirm"])])]),_:1})]),_:1},8,["data"])),[[J,n.value]]),u("div",Me,[r(G,{"current-page":S.currentPage,"onUpdate:currentPage":a[2]||(a[2]=e=>S.currentPage=e),"page-size":S.pageSize,"onUpdate:pageSize":a[3]||(a[3]=e=>S.pageSize=e),"page-sizes":[10,20,50,100],total:S.total,layout:"total, sizes, prev, pager, next",onSizeChange:R,onCurrentChange:F},null,8,["current-page","page-size","total"])])]),_:1}),r(Z,{modelValue:x.value,"onUpdate:modelValue":a[6]||(a[6]=e=>x.value=e),title:"新建产品",width:"600px"},{footer:d(()=>[u("div",Oe,[r(B,{onClick:a[5]||(a[5]=e=>x.value=!1)},{default:d(()=>[...a[17]||(a[17]=[v("取消",-1)])]),_:1}),r(B,{type:"primary",onClick:O},{default:d(()=>[...a[18]||(a[18]=[v("确定",-1)])]),_:1})])]),default:d(()=>[r(H,{ref_key:"addFormRef",ref:k,model:T,rules:I,"label-width":"100px","label-position":"right"},{default:d(()=>[r(X,{"content-position":"left"},{default:d(()=>[...a[16]||(a[16]=[v("产品信息",-1)])]),_:1}),r(c,{label:"产品名称",prop:"productName"},{default:d(()=>[r(s,{modelValue:T.productName,"onUpdate:modelValue":a[4]||(a[4]=e=>T.productName=e),placeholder:"请输入产品名称",clearable:""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),r(Z,{modelValue:U.value,"onUpdate:modelValue":a[10]||(a[10]=e=>U.value=e),title:"编辑产品",width:"500px"},{footer:d(()=>[u("div",Ke,[r(B,{onClick:a[9]||(a[9]=e=>U.value=!1)},{default:d(()=>[...a[19]||(a[19]=[v("取消",-1)])]),_:1}),r(B,{type:"primary",onClick:K},{default:d(()=>[...a[20]||(a[20]=[v("确定",-1)])]),_:1})])]),default:d(()=>[r(H,{ref_key:"editFormRef",ref:z,model:D,rules:E,"label-width":"100px","label-position":"right"},{default:d(()=>[r(c,{label:"产品编码",prop:"productId"},{default:d(()=>[r(s,{modelValue:D.productId,"onUpdate:modelValue":a[7]||(a[7]=e=>D.productId=e),placeholder:"产品编码",readonly:"",disabled:""},null,8,["modelValue"])]),_:1}),r(c,{label:"产品名称",prop:"productName"},{default:d(()=>[r(s,{modelValue:D.productName,"onUpdate:modelValue":a[8]||(a[8]=e=>D.productName=e),placeholder:"请输入产品名称",clearable:""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-4888b87b"]]),Fe={class:"page-container"},je={class:"filter-line"},Be={class:"filter-line"},He={class:"filter-line"},$e={class:"filter-line"},qe={class:"filter-buttons"},Le={class:"table-toolbar"},Qe={class:"toolbar-left"},Ge={class:"toolbar-right"},Xe={class:"order-info"},Ze={class:"order-id"},Je={class:"system-id"},We={class:"merchant-info"},ea={class:"merchant-id"},aa={class:"merchant-code"},la={class:"merchant-name"},ta={class:"card-info"},oa={class:"card-number"},ra={class:"card-password"},da={class:"pagination-container"},ua=e({__name:"OrderManagement",setup(e){const n=s(!1),f=s(!1),g=s([]),y=c({orderNo:"",productName:"",transactionStatus:"",verificationStatus:"",withdrawalTime:[],merchantOrderNo:"",systemOrderNo:"",faceValue:"",cardNo:"",merchantCode:"",merchantName:""}),V=c({currentPage:1,pageSize:20,total:0}),N=m(()=>g.value.some(e=>"verified"!==e.verificationStatus&&"locked"!==e.verificationStatus)),S=m(()=>g.value.some(e=>"locked"===e.verificationStatus)),C=m(()=>g.value.filter(e=>"verified"!==e.verificationStatus&&"locked"!==e.verificationStatus).length),x=m(()=>g.value.filter(e=>"locked"===e.verificationStatus).length),k=s([{id:1,orderNo:"ORD20241201001",systemId:"SYS001",productName:"Steam充值卡",cardNumber:"1234-5678-9012-3456",cardPassword:"ABC123DEF456",transactionAmount:100,transactionQuantity:1,transactionStatus:"success",withdrawalTime:"2024-12-01 10:30:00",verificationStatus:"verified",withdrawalTimestamp:1733025e3,faceValue:100},{id:2,orderNo:"ORD20241201002",systemId:"SYS002",productName:"Apple Store充值卡",cardNumber:"9876-5432-1098-7654",cardPassword:"XYZ789GHI012",transactionAmount:50,transactionQuantity:1,transactionStatus:"processing",withdrawalTime:"2024-12-01 11:15:00",verificationStatus:"unverified",withdrawalTimestamp:1733027700,faceValue:50}]);V.total=k.value.length;const T=e=>({success:"处理成功",processing:"处理中",failed:"处理失败"}[e]||"未知状态"),I=e=>({verified:"已核销",unverified:"未核销",locked:"已锁定"}[e]||"未知状态"),z=async()=>{try{n.value=!0,await new Promise(e=>setTimeout(e,500));let e=F;if(y.cardNo&&y.cardNo.trim()){const a=y.cardNo.split("\n").map(e=>e.trim()).filter(e=>e.length>0);a.length>0&&(e=e.filter(e=>a.some(a=>e.cardNumber&&e.cardNumber.includes(a))))}y.orderNo&&(e=e.filter(e=>e.orderNo&&e.orderNo.includes(y.orderNo))),y.productName&&(e=e.filter(e=>e.productName&&e.productName.includes(y.productName))),y.transactionStatus&&(e=e.filter(e=>e.transactionStatus===y.transactionStatus)),y.verificationStatus&&(e=e.filter(e=>e.verificationStatus===y.verificationStatus)),y.merchantOrderNo&&(e=e.filter(e=>e.merchantOrderNo&&e.merchantOrderNo.includes(y.merchantOrderNo))),y.systemOrderNo&&(e=e.filter(e=>e.systemId&&e.systemId.includes(y.systemOrderNo))),y.faceValue&&(e=e.filter(e=>e.faceValue&&e.faceValue.toString().includes(y.faceValue))),y.merchantCode&&(e=e.filter(e=>e.merchantCode&&e.merchantCode.includes(y.merchantCode))),y.merchantName&&(e=e.filter(e=>e.merchantName&&e.merchantName.includes(y.merchantName))),V.total=e.length;const a=(V.currentPage-1)*V.pageSize,l=a+V.pageSize;k.value=e.slice(a,l)}catch(e){P.error("加载数据失败")}finally{n.value=!1}},D=async()=>{V.currentPage=1,await z()},E=()=>{Object.assign(y,{orderNo:"",productName:"",transactionStatus:"",verificationStatus:"",withdrawalTime:[],merchantOrderNo:"",systemOrderNo:"",faceValue:"",cardNo:""}),V.currentPage=1,z()},A=async()=>{await z()},Y=e=>{g.value=e},M=async()=>{if(0===g.value.length)return void P.warning("请选择要锁卡的记录");const e=g.value.filter(e=>"verified"!==e.verificationStatus&&"locked"!==e.verificationStatus);if(0!==e.length)try{await U.confirm(`确定要锁定选中的 ${e.length} 张卡吗？`,"批量锁卡确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await new Promise(e=>setTimeout(e,1e3)),e.forEach(e=>{e.verificationStatus="locked"}),P.success(`成功锁定 ${e.length} 张卡`),g.value=[]}catch(a){"cancel"!==a&&P.error("批量锁卡失败")}else P.warning("选中的记录中没有可锁卡的项目")},O=async()=>{if(0===g.value.length)return void P.warning("请选择要解锁的记录");const e=g.value.filter(e=>"locked"===e.verificationStatus);if(0!==e.length)try{await U.confirm(`确定要解锁选中的 ${e.length} 张卡吗？`,"批量解锁确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await new Promise(e=>setTimeout(e,1e3)),e.forEach(e=>{e.verificationStatus="unverified"}),P.success(`成功解锁 ${e.length} 张卡`),g.value=[]}catch(a){"cancel"!==a&&P.error("批量解锁失败")}else P.warning("选中的记录中没有可解锁的项目")},K=e=>{V.pageSize=e,V.currentPage=1,z()},R=e=>{V.currentPage=e,z()},F=[{id:1,orderNo:"ORD20241201001",systemId:"SYS001",productName:"Steam充值卡",cardNumber:"1234-5678-9012-3456",cardPassword:"ABC123DEF456",transactionAmount:100,transactionQuantity:1,transactionStatus:"success",withdrawalTime:"2024-12-01 10:30:00",verificationStatus:"verified",withdrawalTimestamp:1733025e3,faceValue:100,merchantOrderNo:"MERCH001",systemOrderNo:"SYS001",merchantId:"M001",merchantCode:"MC001",merchantName:"阿里巴巴"},{id:2,orderNo:"ORD20241201002",systemId:"SYS002",productName:"Apple Store充值卡",cardNumber:"9876-5432-1098-7654",cardPassword:"XYZ789GHI012",transactionAmount:50,transactionQuantity:1,transactionStatus:"processing",withdrawalTime:"2024-12-01 11:15:00",verificationStatus:"unverified",withdrawalTimestamp:1733027700,faceValue:50,merchantOrderNo:"MERCH002",systemOrderNo:"SYS002",merchantId:"M002",merchantCode:"MC002",merchantName:"腾讯科技"},{id:3,orderNo:"ORD20241201003",systemId:"SYS003",productName:"Google Play充值卡",cardNumber:"1111-2222-3333-4444",cardPassword:"DEF456GHI789",transactionAmount:30,transactionQuantity:1,transactionStatus:"success",withdrawalTime:"2024-12-01 12:00:00",verificationStatus:"locked",withdrawalTimestamp:1733030400,faceValue:30,merchantOrderNo:"MERCH003",systemOrderNo:"SYS003",merchantId:"M003",merchantCode:"MC003",merchantName:"字节跳动"}];return a(()=>{z()}),(e,a)=>{const s=l("el-input"),c=l("el-form-item"),m=l("el-option"),g=l("el-select"),U=l("el-date-picker"),z=l("el-button"),F=l("el-form"),j=l("el-card"),B=l("el-table-column"),H=l("el-tag"),$=l("el-switch"),q=l("el-table"),L=l("el-pagination"),Q=p("loading");return t(),o("div",Fe,[r(j,{shadow:"never",class:"filter-container"},{default:d(()=>[r(F,{model:y,inline:"",class:"multi-line-filter-form"},{default:d(()=>[u("div",je,[r(c,{label:"订单号：",prop:"orderNo"},{default:d(()=>[r(s,{modelValue:y.orderNo,"onUpdate:modelValue":a[0]||(a[0]=e=>y.orderNo=e),placeholder:"请输入订单号",clearable:"",style:{width:"220px"}},null,8,["modelValue"])]),_:1}),r(c,{label:"产品：",prop:"productName"},{default:d(()=>[r(g,{modelValue:y.productName,"onUpdate:modelValue":a[1]||(a[1]=e=>y.productName=e),placeholder:"请选择产品",clearable:"",style:{width:"168px"}},{default:d(()=>[r(m,{label:"联通充值卡",value:"联通充值卡"}),r(m,{label:"移动充值卡",value:"移动充值卡"}),r(m,{label:"电信充值卡",value:"电信充值卡"})]),_:1},8,["modelValue"])]),_:1}),r(c,{label:"交易状态：",prop:"transactionStatus"},{default:d(()=>[r(g,{modelValue:y.transactionStatus,"onUpdate:modelValue":a[2]||(a[2]=e=>y.transactionStatus=e),placeholder:"请选择交易状态",clearable:"",style:{width:"168px"}},{default:d(()=>[r(m,{label:"处理成功",value:"success"}),r(m,{label:"处理中",value:"processing"}),r(m,{label:"处理失败",value:"failed"})]),_:1},8,["modelValue"])]),_:1}),r(c,{label:"核销状态：",prop:"verificationStatus"},{default:d(()=>[r(g,{modelValue:y.verificationStatus,"onUpdate:modelValue":a[3]||(a[3]=e=>y.verificationStatus=e),placeholder:"请选择核销状态",clearable:"",style:{width:"168px"}},{default:d(()=>[r(m,{label:"已核销",value:"verified"}),r(m,{label:"未核销",value:"unverified"}),r(m,{label:"已锁定",value:"locked"})]),_:1},8,["modelValue"])]),_:1}),r(c,{label:"商户号：",prop:"merchantCode"},{default:d(()=>[r(s,{modelValue:y.merchantCode,"onUpdate:modelValue":a[4]||(a[4]=e=>y.merchantCode=e),placeholder:"请输入商户号",clearable:"",style:{width:"168px"}},null,8,["modelValue"])]),_:1})]),u("div",Be,[r(c,{label:"提卡时间：",prop:"withdrawalTime"},{default:d(()=>[r(U,{modelValue:y.withdrawalTime,"onUpdate:modelValue":a[5]||(a[5]=e=>y.withdrawalTime=e),type:"datetimerange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"350px"}},null,8,["modelValue"])]),_:1}),r(c,{label:"商户单号：",prop:"merchantOrderNo"},{default:d(()=>[r(s,{modelValue:y.merchantOrderNo,"onUpdate:modelValue":a[6]||(a[6]=e=>y.merchantOrderNo=e),placeholder:"请输入商户单号",clearable:"",style:{width:"220px"}},null,8,["modelValue"])]),_:1}),r(c,{label:"系统单号：",prop:"systemOrderNo"},{default:d(()=>[r(s,{modelValue:y.systemOrderNo,"onUpdate:modelValue":a[7]||(a[7]=e=>y.systemOrderNo=e),placeholder:"请输入系统单号",clearable:"",style:{width:"220px"}},null,8,["modelValue"])]),_:1}),r(c,{label:"商户名称：",prop:"merchantName"},{default:d(()=>[r(s,{modelValue:y.merchantName,"onUpdate:modelValue":a[8]||(a[8]=e=>y.merchantName=e),placeholder:"请输入商户名称",clearable:"",style:{width:"168px"}},null,8,["modelValue"])]),_:1})]),u("div",He,[r(c,{label:"面值：",prop:"faceValue"},{default:d(()=>[r(g,{modelValue:y.faceValue,"onUpdate:modelValue":a[9]||(a[9]=e=>y.faceValue=e),placeholder:"请选择面值",clearable:"",style:{width:"168px"}},{default:d(()=>[r(m,{label:"10元",value:"10"}),r(m,{label:"20元",value:"20"}),r(m,{label:"30元",value:"30"}),r(m,{label:"50元",value:"50"}),r(m,{label:"100元",value:"100"})]),_:1},8,["modelValue"])]),_:1})]),u("div",$e,[r(c,{label:"卡号：",prop:"cardNo"},{default:d(()=>[r(s,{modelValue:y.cardNo,"onUpdate:modelValue":a[10]||(a[10]=e=>y.cardNo=e),type:"textarea",placeholder:"请输入卡号，多个卡号请换行分隔",rows:3,autosize:{minRows:3,maxRows:6},style:{width:"300px"}},null,8,["modelValue"])]),_:1}),u("div",qe,[r(z,{type:"primary",onClick:D,loading:f.value},{default:d(()=>[...a[13]||(a[13]=[v("查询",-1)])]),_:1},8,["loading"]),r(z,{plain:"",onClick:E},{default:d(()=>[...a[14]||(a[14]=[v("重置",-1)])]),_:1})])])]),_:1},8,["model"])]),_:1}),r(j,null,{default:d(()=>[u("div",Le,[u("div",Qe,[r(z,{type:"primary",disabled:!N.value,onClick:M},{default:d(()=>[v(" 锁卡 ("+_(C.value)+") ",1)]),_:1},8,["disabled"]),r(z,{type:"warning",disabled:!S.value,onClick:O},{default:d(()=>[v(" 解锁 ("+_(x.value)+") ",1)]),_:1},8,["disabled"])]),u("div",Ge,[r(z,{icon:i(h),onClick:A},{default:d(()=>[...a[15]||(a[15]=[v("刷新",-1)])]),_:1},8,["icon"])])]),b((t(),w(q,{data:k.value,border:"",stripe:"",style:{"margin-top":"16px",width:"100%"},onSelectionChange:Y},{default:d(()=>[r(B,{type:"selection",width:"55"}),r(B,{prop:"orderNo",label:"订单号","min-width":"180"},{default:d(({row:e})=>[u("div",Xe,[u("div",Ze,_(e.orderNo),1),u("div",Je,_(e.systemId),1)])]),_:1}),r(B,{prop:"merchantInfo",label:"商户信息","min-width":"200"},{default:d(({row:e})=>[u("div",We,[u("div",ea,_(e.merchantId),1),u("div",aa,_(e.merchantCode),1),u("div",la,_(e.merchantName),1)])]),_:1}),r(B,{prop:"productName",label:"产品","min-width":"150"},{default:d(({row:e,$index:a})=>[u("span",null,"产品"+_(String.fromCharCode(65+a))+"-["+_(e.faceValue)+"]",1)]),_:1}),r(B,{prop:"cardInfo",label:"卡密","min-width":"200"},{default:d(({row:e})=>[u("div",ta,[u("div",oa,_(e.cardNumber),1),u("div",ra,_(e.cardPassword),1)])]),_:1}),r(B,{prop:"transactionAmount",label:"交易金额","min-width":"100"},{default:d(({row:e})=>[v(" ¥"+_(e.transactionAmount),1)]),_:1}),r(B,{prop:"transactionQuantity",label:"交易数量","min-width":"100"}),r(B,{prop:"transactionStatus",label:"交易状态","min-width":"120"},{default:d(({row:e})=>{return[r(H,{type:(a=e.transactionStatus,{success:"success",processing:"warning",failed:"danger"}[a]||"info"),size:"small"},{default:d(()=>[v(_(T(e.transactionStatus)),1)]),_:2},1032,["type"])];var a}),_:1}),r(B,{prop:"withdrawalTime",label:"提卡时间","min-width":"160"}),r(B,{prop:"verificationStatus",label:"核销状态","min-width":"120"},{default:d(({row:e})=>{return[r(H,{type:(a=e.verificationStatus,{verified:"success",unverified:"warning",locked:"danger"}[a]||"info"),size:"small"},{default:d(()=>[v(_(I(e.verificationStatus)),1)]),_:2},1032,["type"])];var a}),_:1}),r(B,{label:"锁卡开关","min-width":"100",align:"center",fixed:"right"},{default:d(({row:e})=>[r($,{"model-value":"locked"===e.verificationStatus,disabled:"verified"===e.verificationStatus,onChange:a=>(async(e,a)=>{try{await new Promise(e=>setTimeout(e,300)),e.verificationStatus=a?"locked":"unverified",P.success(a?"锁卡成功":"解锁成功")}catch(l){P.error(a?"锁卡失败":"解锁失败")}})(e,a),"active-text":"","inactive-text":"","active-color":"verified"===e.verificationStatus?"#C0C4CC":"#13CE66","inactive-color":"verified"===e.verificationStatus?"#C0C4CC":"#DCDFE6"},null,8,["model-value","disabled","onChange","active-color","inactive-color"])]),_:1}),r(B,{prop:"withdrawalTimestamp",label:"核销时间","min-width":"180"},{default:d(({row:e})=>{return[v(_((a=e.withdrawalTimestamp,a?new Date(a).toLocaleString("zh-CN"):"-")),1)];var a}),_:1})]),_:1},8,["data"])),[[Q,n.value]]),u("div",da,[r(L,{"current-page":V.currentPage,"onUpdate:currentPage":a[11]||(a[11]=e=>V.currentPage=e),"page-size":V.pageSize,"onUpdate:pageSize":a[12]||(a[12]=e=>V.pageSize=e),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:V.total,onSizeChange:K,onCurrentChange:R},null,8,["current-page","page-size","total"])])]),_:1})])}}},[["__scopeId","data-v-5e99419e"]]),ia={class:"page-container"},na={class:"filter-line"},sa={class:"filter-line"},ca={class:"filter-line"},ma={class:"filter-buttons"},pa={class:"table-toolbar"},fa={class:"toolbar-left"},va={class:"toolbar-right"},ha={class:"customer-info"},ga={class:"customer-id"},ba={class:"customer-email"},wa={class:"product-info"},_a={class:"product-name"},ya={class:"product-code"},Va={class:"card-info"},Na={class:"card-number"},Sa={class:"card-password"},Ca={class:"pagination-container"},xa=e({__name:"VerificationOrderManagement",setup(e){const n=s(!1),m=s(!1),f=c({orderNo:"",customerId:"",customerEmail:"",orderStatus:"",orderValue:"",cardNo:"",orderTime:[],verificationTime:[]}),g=c({currentPage:1,pageSize:20,total:0}),y=s([{id:1,orderNo:"SF20241201001",customerId:"CUST001",customerEmail:"user1@example.com",productName:"产品A",productCode:"PROD_A_100",orderValue:100,cardNumber:"1234-5678-9012-3456",cardPassword:"ABC123DEF456",orderTime:"2024-12-01 10:30:00",verificationTime:"2024-12-01 11:00:00",verificationStatus:"verified"},{id:2,orderNo:"SF20241201002",customerId:"CUST002",customerEmail:"user2@example.com",productName:"产品A",productCode:"PROD_A_50",orderValue:50,cardNumber:"9876-5432-1098-7654",cardPassword:"XYZ789GHI012",orderTime:"2024-12-01 11:15:00",verificationTime:null,verificationStatus:"unverified"},{id:3,orderNo:"SF20241201003",customerId:"CUST003",customerEmail:"user3@example.com",productName:"产品A",productCode:"PROD_A_20",orderValue:20,cardNumber:"5555-4444-3333-2222",cardPassword:"DEF456GHI789",orderTime:"2024-12-01 12:00:00",verificationTime:null,verificationStatus:"locked"},{id:4,orderNo:"SF20241201004",customerId:"CUST004",customerEmail:"user4@example.com",productName:"产品A",productCode:"PROD_A_200",orderValue:200,cardNumber:"1111-2222-3333-4444",cardPassword:"MNO345PQR678",orderTime:"2024-12-01 13:00:00",verificationTime:"2024-12-01 13:45:00",verificationStatus:"verified"}]);g.total=y.value.length;const V=()=>{m.value=!0,setTimeout(()=>{m.value=!1,P.success("查询完成")},1e3)},N=()=>{Object.keys(f).forEach(e=>{Array.isArray(f[e])?f[e]=[]:f[e]=""}),P.info("筛选条件已重置")},S=()=>{n.value=!0,setTimeout(()=>{n.value=!1,P.success("数据已刷新")},1e3)},C=()=>{P.success("导出功能开发中")},x=e=>{g.pageSize=e,g.currentPage=1},k=e=>{g.currentPage=e},T=e=>({verified:"已核销",unverified:"未核销",locked:"已锁定"}[e]||"未知状态"),I=e=>"unverified"===e.verificationStatus||"locked"===e.verificationStatus?"":e.verificationTime||"";return a(()=>{}),(e,a)=>{const s=l("el-input"),c=l("el-form-item"),D=l("el-option"),E=l("el-select"),A=l("el-date-picker"),Y=l("el-button"),M=l("el-form"),O=l("el-card"),K=l("el-table-column"),R=l("el-tag"),F=l("el-table"),j=l("el-pagination"),B=p("loading");return t(),o("div",ia,[r(O,{shadow:"never",class:"filter-container"},{default:d(()=>[r(M,{model:f,inline:"",class:"multi-line-filter-form"},{default:d(()=>[u("div",na,[r(c,{label:"订单号：",prop:"orderNo"},{default:d(()=>[r(s,{modelValue:f.orderNo,"onUpdate:modelValue":a[0]||(a[0]=e=>f.orderNo=e),placeholder:"请输入订单号",clearable:"",style:{width:"220px"}},null,8,["modelValue"])]),_:1}),r(c,{label:"客户ID：",prop:"customerId"},{default:d(()=>[r(s,{modelValue:f.customerId,"onUpdate:modelValue":a[1]||(a[1]=e=>f.customerId=e),placeholder:"请输入客户ID",clearable:"",style:{width:"168px"}},null,8,["modelValue"])]),_:1}),r(c,{label:"客户邮箱：",prop:"customerEmail"},{default:d(()=>[r(s,{modelValue:f.customerEmail,"onUpdate:modelValue":a[2]||(a[2]=e=>f.customerEmail=e),placeholder:"请输入客户邮箱",clearable:"",style:{width:"220px"}},null,8,["modelValue"])]),_:1}),r(c,{label:"订单状态：",prop:"orderStatus"},{default:d(()=>[r(E,{modelValue:f.orderStatus,"onUpdate:modelValue":a[3]||(a[3]=e=>f.orderStatus=e),placeholder:"请选择订单状态",clearable:"",style:{width:"168px"}},{default:d(()=>[r(D,{label:"已完成",value:"completed"}),r(D,{label:"处理中",value:"processing"}),r(D,{label:"已取消",value:"cancelled"})]),_:1},8,["modelValue"])]),_:1})]),u("div",sa,[r(c,{label:"订单面值：",prop:"orderValue"},{default:d(()=>[r(E,{modelValue:f.orderValue,"onUpdate:modelValue":a[4]||(a[4]=e=>f.orderValue=e),placeholder:"请选择订单面值",clearable:"",style:{width:"168px"}},{default:d(()=>[r(D,{label:"10元",value:"10"}),r(D,{label:"20元",value:"20"}),r(D,{label:"50元",value:"50"}),r(D,{label:"100元",value:"100"})]),_:1},8,["modelValue"])]),_:1}),r(c,{label:"卡号：",prop:"cardNo"},{default:d(()=>[r(s,{modelValue:f.cardNo,"onUpdate:modelValue":a[5]||(a[5]=e=>f.cardNo=e),placeholder:"请输入卡号",clearable:"",style:{width:"220px"}},null,8,["modelValue"])]),_:1})]),u("div",ca,[r(c,{label:"下单时间：",prop:"orderTime"},{default:d(()=>[r(A,{modelValue:f.orderTime,"onUpdate:modelValue":a[6]||(a[6]=e=>f.orderTime=e),type:"datetimerange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"350px"}},null,8,["modelValue"])]),_:1}),r(c,{label:"核销时间：",prop:"verificationTime"},{default:d(()=>[r(A,{modelValue:f.verificationTime,"onUpdate:modelValue":a[7]||(a[7]=e=>f.verificationTime=e),type:"datetimerange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"350px"}},null,8,["modelValue"])]),_:1}),u("div",ma,[r(Y,{type:"primary",onClick:V,loading:m.value},{default:d(()=>[...a[10]||(a[10]=[v("查询",-1)])]),_:1},8,["loading"]),r(Y,{plain:"",onClick:N},{default:d(()=>[...a[11]||(a[11]=[v("重置",-1)])]),_:1})])])]),_:1},8,["model"])]),_:1}),r(O,null,{default:d(()=>[u("div",pa,[u("div",fa,[r(Y,{type:"primary",onClick:C},{default:d(()=>[...a[12]||(a[12]=[v("导出数据",-1)])]),_:1})]),u("div",va,[r(Y,{icon:i(h),onClick:S},{default:d(()=>[...a[13]||(a[13]=[v("刷新",-1)])]),_:1},8,["icon"])])]),b((t(),w(F,{data:y.value,border:"",stripe:"",style:{"margin-top":"16px",width:"100%"}},{default:d(()=>[r(K,{prop:"orderNo",label:"订单号","min-width":"180"},{default:d(({row:e})=>[v(_(e.orderNo),1)]),_:1}),r(K,{prop:"customerInfo",label:"客户信息","min-width":"200"},{default:d(({row:e})=>[u("div",ha,[u("div",ga,_(e.customerId),1),u("div",ba,_(e.customerEmail),1)])]),_:1}),r(K,{prop:"productName",label:"产品","min-width":"200"},{default:d(({row:e})=>[u("div",wa,[u("div",_a,_(e.productName)+"-["+_(e.orderValue)+"]",1),u("div",ya,"编码："+_(e.productCode),1)])]),_:1}),r(K,{prop:"orderValue",label:"订单面值","min-width":"100"},{default:d(({row:e})=>[v(" ¥"+_(e.orderValue),1)]),_:1}),r(K,{prop:"verificationStatus",label:"核销状态","min-width":"100"},{default:d(({row:e})=>{return[r(R,{type:(a=e.verificationStatus,{verified:"success",unverified:"warning",locked:"danger"}[a]||"info")},{default:d(()=>[v(_(T(e.verificationStatus)),1)]),_:2},1032,["type"])];var a}),_:1}),r(K,{prop:"cardInfo",label:"卡密信息","min-width":"200"},{default:d(({row:e})=>[u("div",Va,[u("div",Na,_(e.cardNumber),1),u("div",Sa,_(e.cardPassword),1)])]),_:1}),r(K,{prop:"verificationTime",label:"核销时间","min-width":"180"},{default:d(({row:e})=>[v(_(I(e)),1)]),_:1}),r(K,{label:"操作",width:"120",fixed:"right"},{default:d(({row:e})=>["unverified"===e.verificationStatus?(t(),w(Y,{key:0,link:"",type:"primary",onClick:a=>(async e=>{try{await U.confirm("是否人工确定核销此卡密？","核销确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const a=y.value.findIndex(a=>a.id===e.id);-1!==a&&(y.value[a].verificationStatus="verified",y.value[a].verificationTime=(new Date).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).replace(/\//g,"-")),P.success("核销成功")}catch(a){"cancel"!==a&&P.error("核销失败")}})(e)},{default:d(()=>[...a[14]||(a[14]=[v(" 核销 ",-1)])]),_:2},1032,["onClick"])):"verified"===e.verificationStatus?(t(),w(Y,{key:1,link:"",type:"info",onClick:a=>(e=>{P.info(`查看核销日志：${e.orderNo}`)})(e)},{default:d(()=>[...a[15]||(a[15]=[v(" 核销日志 ",-1)])]),_:2},1032,["onClick"])):z("",!0)]),_:1})]),_:1},8,["data"])),[[B,n.value]]),u("div",Ca,[r(j,{"current-page":g.currentPage,"onUpdate:currentPage":a[8]||(a[8]=e=>g.currentPage=e),"page-size":g.pageSize,"onUpdate:pageSize":a[9]||(a[9]=e=>g.pageSize=e),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:g.total,onSizeChange:x,onCurrentChange:k},null,8,["current-page","page-size","total"])])]),_:1})])}}},[["__scopeId","data-v-f6564994"]]),ka={class:"sub-account-management"},Ta={class:"filter-line"},Ia={class:"filter-buttons"},Pa={class:"pagination-container"},Ua={class:"dialog-footer"},za={class:"dialog-footer"},Da=e({__name:"SubAccountManagement",setup(e){const n=c({username:"",status:""}),m=s([{accountId:1,username:"admin",status:"enabled",createTime:"1970-01-01 00:00:00"},{accountId:2,username:"user001",status:"disabled",createTime:"2024-01-15 10:30:00"},{accountId:3,username:"manager",status:"enabled",createTime:"2024-02-20 14:20:00"}]),g=s(!1),y=c({currentPage:1,pageSize:10,total:3}),V=s(!1),S=s(),x=c({username:"",status:"enabled"}),k={username:[{required:!0,message:"请输入用户名",trigger:"blur"}]},T=s(!1),I=s(),z=c({accountId:null,username:"",status:"enabled"}),D={username:[{required:!0,message:"请输入用户名",trigger:"blur"}]};function E(){g.value=!0,setTimeout(()=>{g.value=!1,P.success("搜索完成")},1e3)}function A(){Object.assign(n,{username:"",status:""}),P.info("筛选条件已重置")}function Y(e){y.pageSize=e}function M(e){y.currentPage=e}function O(){S.value.validate(e=>{if(e){const e={accountId:Date.now(),username:x.username,status:x.status,createTime:(new Date).toLocaleString("zh-CN")};m.value.unshift(e),y.total++,V.value=!1,P.success("新增成功")}})}function K(){I.value.validate(e=>{if(e){const e=m.value.findIndex(e=>e.accountId===z.accountId);e>-1&&(m.value[e].username=z.username,m.value[e].status=z.status,T.value=!1,P.success("编辑成功"))}})}return a(()=>{}),(e,a)=>{const s=l("el-input"),c=l("el-form-item"),R=l("el-option"),F=l("el-select"),j=l("el-button"),B=l("el-form"),H=l("el-card"),$=l("el-table-column"),q=l("el-tag"),L=l("el-popconfirm"),Q=l("el-table"),G=l("el-pagination"),X=l("el-switch"),Z=l("el-dialog"),J=p("loading");return t(),o("div",ka,[r(H,{shadow:"never",class:"filter-container"},{default:d(()=>[r(B,{model:n,class:"multi-line-filter-form"},{default:d(()=>[u("div",Ta,[r(c,{label:"用户名：",prop:"username"},{default:d(()=>[r(s,{modelValue:n.username,"onUpdate:modelValue":a[0]||(a[0]=e=>n.username=e),placeholder:"请输入用户名",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),r(c,{label:"启用状态：",prop:"status"},{default:d(()=>[r(F,{modelValue:n.status,"onUpdate:modelValue":a[1]||(a[1]=e=>n.status=e),placeholder:"请选择状态",clearable:"",style:{width:"168px"}},{default:d(()=>[r(R,{label:"启用",value:"1"}),r(R,{label:"禁用",value:"0"})]),_:1},8,["modelValue"])]),_:1}),u("div",Ia,[r(j,{type:"primary",icon:i(f),onClick:E},{default:d(()=>[...a[12]||(a[12]=[v("查询",-1)])]),_:1},8,["icon"]),r(j,{plain:"",icon:i(h),onClick:A},{default:d(()=>[...a[13]||(a[13]=[v("重置",-1)])]),_:1},8,["icon"])])])]),_:1},8,["model"])]),_:1}),r(H,{shadow:"never",class:"table-card"},{default:d(()=>[b((t(),w(Q,{data:m.value,border:"",stripe:"",style:{width:"100%",height:"calc(100vh - 280px)"},height:"calc(100vh - 280px)"},{default:d(()=>[r($,{prop:"accountId",label:"账户ID",width:"100"}),r($,{prop:"username",label:"用户名",width:"180"}),r($,{prop:"status",label:"状态",width:"120",align:"center"},{default:d(({row:e})=>[r(q,{type:"enabled"===e.status?"success":"danger"},{default:d(()=>[v(_("enabled"===e.status?"已启用":"已禁用"),1)]),_:2},1032,["type"])]),_:1}),r($,{prop:"createTime",label:"创建时间","min-width":"200"}),r($,{label:"操作",width:"180",fixed:"right"},{default:d(({row:e})=>[r(j,{link:"",type:"primary",icon:i(N),onClick:a=>function(e){Object.assign(z,{accountId:e.accountId,username:e.username,status:e.status}),T.value=!0}(e)},{default:d(()=>[...a[14]||(a[14]=[v("编辑",-1)])]),_:2},1032,["icon","onClick"]),r(L,{title:"确认删除该账户？",onConfirm:a=>function(e){U.confirm(`确定要删除账户 "${e.username}" 吗？`,"删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{const a=m.value.findIndex(a=>a.accountId===e.accountId);a>-1&&(m.value.splice(a,1),y.total--,P.success("删除成功"))}).catch(()=>{P.info("已取消删除")})}(e)},{reference:d(()=>[r(j,{link:"",type:"danger",icon:i(C)},{default:d(()=>[...a[15]||(a[15]=[v("删除",-1)])]),_:1},8,["icon"])]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"])),[[J,g.value]]),u("div",Pa,[r(G,{"current-page":y.currentPage,"onUpdate:currentPage":a[2]||(a[2]=e=>y.currentPage=e),"page-size":y.pageSize,"onUpdate:pageSize":a[3]||(a[3]=e=>y.pageSize=e),"page-sizes":[10,20,50,100],total:y.total,layout:"total, sizes, prev, pager, next",onSizeChange:Y,onCurrentChange:M},null,8,["current-page","page-size","total"])])]),_:1}),r(Z,{modelValue:V.value,"onUpdate:modelValue":a[7]||(a[7]=e=>V.value=e),title:"新增账户",width:"500px"},{footer:d(()=>[u("div",Ua,[r(j,{onClick:a[6]||(a[6]=e=>V.value=!1)},{default:d(()=>[...a[16]||(a[16]=[v("取消",-1)])]),_:1}),r(j,{type:"primary",onClick:O},{default:d(()=>[...a[17]||(a[17]=[v("确定",-1)])]),_:1})])]),default:d(()=>[r(B,{ref_key:"addFormRef",ref:S,model:x,rules:k,"label-width":"100px","label-position":"right"},{default:d(()=>[r(c,{label:"用户名",prop:"username"},{default:d(()=>[r(s,{modelValue:x.username,"onUpdate:modelValue":a[4]||(a[4]=e=>x.username=e),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),r(c,{label:"启用状态"},{default:d(()=>[r(X,{modelValue:x.status,"onUpdate:modelValue":a[5]||(a[5]=e=>x.status=e),"active-value":"enabled","inactive-value":"disabled"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),r(Z,{modelValue:T.value,"onUpdate:modelValue":a[11]||(a[11]=e=>T.value=e),title:"编辑账户",width:"500px"},{footer:d(()=>[u("div",za,[r(j,{onClick:a[10]||(a[10]=e=>T.value=!1)},{default:d(()=>[...a[18]||(a[18]=[v("取消",-1)])]),_:1}),r(j,{type:"primary",onClick:K},{default:d(()=>[...a[19]||(a[19]=[v("确定",-1)])]),_:1})])]),default:d(()=>[r(B,{ref_key:"editFormRef",ref:I,model:z,rules:D,"label-width":"100px","label-position":"right"},{default:d(()=>[r(c,{label:"用户名",prop:"username"},{default:d(()=>[r(s,{modelValue:z.username,"onUpdate:modelValue":a[8]||(a[8]=e=>z.username=e),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),r(c,{label:"启用状态"},{default:d(()=>[r(X,{modelValue:z.status,"onUpdate:modelValue":a[9]||(a[9]=e=>z.status=e),"active-value":"enabled","inactive-value":"disabled"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-f847edc8"]]),Ea={class:"operation-log"},Aa={class:"filter-line"},Ya={class:"filter-buttons"},Ma={class:"pagination-container"},Oa=e({__name:"OperationLog",setup(e){const n=c({username:"",timeRange:[]}),m=s([{accountId:1,username:"admin",operationType:"登录系统",operationTime:"2025-08-21 09:30:15",ipAddress:"192.168.1.100",description:"管理员登录后台管理系统"},{accountId:2,username:"user001",operationType:"查看订单",operationTime:"2025-08-21 10:15:22",ipAddress:"192.168.1.101",description:"查看订单列表，筛选条件：状态为已完成"},{accountId:1,username:"admin",operationType:"创建卡密",operationTime:"2025-08-21 11:20:45",ipAddress:"192.168.1.100",description:"批量创建卡密，数量：100张"},{accountId:3,username:"manager",operationType:"编辑用户",operationTime:"2025-08-21 14:35:18",ipAddress:"192.168.1.102",description:"修改用户权限，用户ID：12345"},{accountId:2,username:"user001",operationType:"导出数据",operationTime:"2025-08-21 15:42:33",ipAddress:"192.168.1.101",description:"导出订单数据，时间范围：2025-08-01至2025-08-21"}]),g=s(!1),_=c({currentPage:1,pageSize:10,total:5});function y(){g.value=!0,setTimeout(()=>{g.value=!1,P.success("搜索完成")},1e3)}function V(){Object.assign(n,{username:"",timeRange:[]}),P.info("筛选条件已重置")}function N(e){_.pageSize=e}function S(e){_.currentPage=e}return a(()=>{}),(e,a)=>{const s=l("el-input"),c=l("el-form-item"),C=l("el-date-picker"),x=l("el-button"),k=l("el-form"),T=l("el-card"),I=l("el-table-column"),P=l("el-table"),U=l("el-pagination"),z=p("loading");return t(),o("div",Ea,[r(T,{shadow:"never",class:"filter-container"},{default:d(()=>[r(k,{model:n,class:"multi-line-filter-form"},{default:d(()=>[u("div",Aa,[r(c,{label:"用户名：",prop:"username"},{default:d(()=>[r(s,{modelValue:n.username,"onUpdate:modelValue":a[0]||(a[0]=e=>n.username=e),placeholder:"请输入用户名",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),r(c,{label:"时间范围：",prop:"timeRange"},{default:d(()=>[r(C,{modelValue:n.timeRange,"onUpdate:modelValue":a[1]||(a[1]=e=>n.timeRange=e),type:"datetimerange","range-separator":"-","start-placeholder":"开始时间","end-placeholder":"结束时间",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"300px"}},null,8,["modelValue"])]),_:1}),u("div",Ya,[r(x,{type:"primary",icon:i(f),onClick:y},{default:d(()=>[...a[4]||(a[4]=[v("查询",-1)])]),_:1},8,["icon"]),r(x,{plain:"",icon:i(h),onClick:V},{default:d(()=>[...a[5]||(a[5]=[v("重置",-1)])]),_:1},8,["icon"])])])]),_:1},8,["model"])]),_:1}),r(T,null,{default:d(()=>[b((t(),w(P,{data:m.value,border:"",stripe:"",style:{width:"100%"}},{default:d(()=>[r(I,{prop:"accountId",label:"账户ID",width:"100",align:"center"}),r(I,{prop:"username",label:"用户名",width:"120"}),r(I,{prop:"operationType",label:"操作类型",width:"120"}),r(I,{prop:"operationTime",label:"操作时间",width:"180"}),r(I,{prop:"ipAddress",label:"IP地址",width:"140",align:"center"}),r(I,{prop:"description",label:"操作描述","min-width":"250","show-overflow-tooltip":""})]),_:1},8,["data"])),[[z,g.value]]),u("div",Ma,[r(U,{"current-page":_.currentPage,"onUpdate:currentPage":a[2]||(a[2]=e=>_.currentPage=e),"page-size":_.pageSize,"onUpdate:pageSize":a[3]||(a[3]=e=>_.pageSize=e),"page-sizes":[10,20,50,100],total:_.total,layout:"total, sizes, prev, pager, next",onSizeChange:N,onCurrentChange:S},null,8,["current-page","page-size","total"])])]),_:1})])}}},[["__scopeId","data-v-7a303fc9"]]),Ka={class:"reset-password"},Ra={class:"form-container"},Fa=e({__name:"ResetPassword",setup(e){const a=s(),i=s(!1),n=c({currentPassword:"",newPassword:"",confirmPassword:""}),m={currentPassword:[{required:!0,message:"请输入当前密码",trigger:"blur"}],newPassword:[{required:!0,validator:(e,l,t)=>{""===l?t(new Error("请输入新密码")):l.length<6?t(new Error("密码长度不能少于6位")):l===n.currentPassword?t(new Error("新密码不能与当前密码相同")):(""!==n.confirmPassword&&a.value.validateField("confirmPassword"),t())},trigger:"blur"}],confirmPassword:[{required:!0,validator:(e,a,l)=>{""===a?l(new Error("请再次输入新密码")):a!==n.newPassword?l(new Error("两次输入密码不一致")):l()},trigger:"blur"}]},p=async()=>{try{await a.value.validate(),i.value=!0,await new Promise(e=>setTimeout(e,1e3)),P.success("密码修改成功"),f()}catch(e){}finally{i.value=!1}},f=()=>{var e;null==(e=a.value)||e.resetFields(),Object.assign(n,{currentPassword:"",newPassword:"",confirmPassword:""})};return(e,s)=>{const c=l("el-input"),h=l("el-form-item"),g=l("el-button"),b=l("el-space"),w=l("el-form"),_=l("el-card");return t(),o("div",Ka,[u("div",Ra,[r(_,{class:"form-card"},{default:d(()=>[r(w,{ref_key:"passwordFormRef",ref:a,model:n,rules:m,"label-width":"100px"},{default:d(()=>[r(h,{label:"当前密码",prop:"currentPassword"},{default:d(()=>[r(c,{modelValue:n.currentPassword,"onUpdate:modelValue":s[0]||(s[0]=e=>n.currentPassword=e),type:"password",placeholder:"请输入当前密码","show-password":""},null,8,["modelValue"])]),_:1}),r(h,{label:"新密码",prop:"newPassword"},{default:d(()=>[r(c,{modelValue:n.newPassword,"onUpdate:modelValue":s[1]||(s[1]=e=>n.newPassword=e),type:"password",placeholder:"请输入新密码","show-password":""},null,8,["modelValue"])]),_:1}),r(h,{label:"确认新密码",prop:"confirmPassword"},{default:d(()=>[r(c,{modelValue:n.confirmPassword,"onUpdate:modelValue":s[2]||(s[2]=e=>n.confirmPassword=e),type:"password",placeholder:"请再次输入新密码","show-password":""},null,8,["modelValue"])]),_:1}),r(h,null,{default:d(()=>[r(b,null,{default:d(()=>[r(g,{type:"primary",loading:i.value,onClick:p},{default:d(()=>[...s[3]||(s[3]=[v(" 保存 ",-1)])]),_:1},8,["loading"]),r(g,{onClick:f},{default:d(()=>[...s[4]||(s[4]=[v("重置",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})])])}}},[["__scopeId","data-v-4a638ec1"]]),ja={class:"admin-layout"},Ba={class:"header-right"},Ha={class:"el-dropdown-link"},$a=e({__name:"AdminLayout",setup(e){const a=s("dashboard"),n=D($),c={dashboard:$,"customer-management":Ie,"card-management":Re,"order-management":ua,"verification-order-management":xa,"subaccount-management":Da,"operation-log":Oa,"reset-password":Fa},m=e=>{a.value=e,n.value=c[e]},p=e=>{if("logout"===e)P.success("退出登录成功")};return(e,s)=>{const c=l("el-icon"),f=l("el-dropdown-item"),h=l("el-dropdown-menu"),g=l("el-dropdown"),b=l("el-header"),_=l("el-menu-item"),y=l("el-sub-menu"),V=l("el-menu"),N=l("el-aside"),C=l("el-main"),k=l("el-container");return t(),o("div",ja,[r(b,{class:"header"},{default:d(()=>[s[2]||(s[2]=u("div",{class:"header-left"},[u("h2",null,"卡密核销系统")],-1)),u("div",Ba,[r(g,{onCommand:p},{dropdown:d(()=>[r(h,null,{default:d(()=>[r(f,{command:"logout"},{default:d(()=>[...s[1]||(s[1]=[v("退出登录",-1)])]),_:1})]),_:1})]),default:d(()=>[u("span",Ha,[s[0]||(s[0]=v(" admin ",-1)),r(c,{class:"el-icon--right"},{default:d(()=>[r(i(x))]),_:1})])]),_:1})])]),_:1}),r(k,null,{default:d(()=>[r(N,{width:"200px",class:"sidebar"},{default:d(()=>[r(V,{"default-active":a.value,class:"el-menu-vertical",onSelect:m},{default:d(()=>[r(_,{index:"dashboard"},{default:d(()=>[r(c,null,{default:d(()=>[r(i(E))]),_:1}),s[3]||(s[3]=u("span",null,"仪表盘",-1))]),_:1}),r(_,{index:"customer-management"},{default:d(()=>[r(c,null,{default:d(()=>[r(i(A))]),_:1}),s[4]||(s[4]=u("span",null,"客户管理",-1))]),_:1}),r(_,{index:"card-management"},{default:d(()=>[r(c,null,{default:d(()=>[r(i(Y))]),_:1}),s[5]||(s[5]=u("span",null,"产品管理",-1))]),_:1}),r(_,{index:"order-management"},{default:d(()=>[r(c,null,{default:d(()=>[r(i(M))]),_:1}),s[6]||(s[6]=u("span",null,"提卡订单",-1))]),_:1}),r(_,{index:"verification-order-management"},{default:d(()=>[r(c,null,{default:d(()=>[r(i(M))]),_:1}),s[7]||(s[7]=u("span",null,"核销订单",-1))]),_:1}),r(y,{index:"system-settings"},{title:d(()=>[r(c,null,{default:d(()=>[r(i(S))]),_:1}),s[8]||(s[8]=u("span",null,"系统设置",-1))]),default:d(()=>[r(_,{index:"subaccount-management"},{default:d(()=>[r(c,null,{default:d(()=>[r(i(O))]),_:1}),s[9]||(s[9]=u("span",null,"子账户管理",-1))]),_:1}),r(_,{index:"operation-log"},{default:d(()=>[r(c,null,{default:d(()=>[r(i(K))]),_:1}),s[10]||(s[10]=u("span",null,"操作日志",-1))]),_:1}),r(_,{index:"reset-password"},{default:d(()=>[r(c,null,{default:d(()=>[r(i(R))]),_:1}),s[11]||(s[11]=u("span",null,"重置密码",-1))]),_:1})]),_:1})]),_:1},8,["default-active"])]),_:1}),r(C,{class:"main-content"},{default:d(()=>[(t(),w(F(n.value)))]),_:1})]),_:1})])}}},[["__scopeId","data-v-fbdb4f10"]]);export{$a as A};
