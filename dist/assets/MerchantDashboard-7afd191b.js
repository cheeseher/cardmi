import{_ as e,k as a,h as t,j as l,f as r,r as o,o as s,c as n,a as i,w as d,g as u,x as c,u as p,y as m,n as f,F as w,U as v,J as h,l as g,t as _,v as b,p as y,K as P,L as S,O as N,P as C,V,S as I,W as T,T as x}from"./_plugin-vue_export-helper-18a4c639.js";const D={class:"merchant-product-management"},A={class:"merchant-info"},k={class:"info-row"},E={class:"info-item"},Y={class:"value"},z={class:"info-row"},O={class:"info-item"},U={class:"value"},R={class:"info-row"},M={class:"info-item"},$={class:"value"},B={class:"info-row"},H={class:"info-item"},F={class:"value ip-list"},K={class:"info-row"},L={class:"info-item"},W={class:"value balance-amount"},j={class:"action-buttons"},Q={class:"product-name"},q={class:"rate-value"},G={key:0},J={key:1},X={class:"pagination-container"},Z={class:"dialog-footer"},ee={class:"form-tip"},ae={class:"dialog-footer"},te=e({__name:"MerchantProductManagement",props:{merchantInfo:{type:Object,default:()=>null}},setup(e){const g=e,_=a(()=>g.merchantInfo?{merchantId:g.merchantInfo.customerId,merchantNo:g.merchantInfo.merchantNo,signPassword:g.merchantInfo.signKey||"YOUR_SIGN_KEY_HERE",aesPassword:g.merchantInfo.merchantKey||"YOUR_AES_KEY_HERE",ipWhitelist:"39.98.76.22,39.98.76.22",balance:"15680.50"}:{merchantId:"10",merchantNo:"M17408123456",signPassword:"YOUR_SIGN_KEY_HERE",aesPassword:"YOUR_AES_KEY_HERE",ipWhitelist:"39.98.76.22,39.98.76.22",balance:"15680.50"}),b=t([{productName:"产品A-[10]",productCode:"PD1001",rate:"0.9760",status:"已开启",faceValue:10,productId:"PD1001"},{productName:"产品A-[20]",productCode:"PD1002",rate:"0.9760",status:"已开启",faceValue:20,productId:"PD1002"},{productName:"产品A-[30]",productCode:"PD1003",rate:"0.9760",status:"已开启",faceValue:30,productId:"PD1003"},{productName:"产品B-[50]",productCode:"PD1004",rate:"0.9760",status:"已开启",faceValue:50,productId:"PD1004"},{productName:"产品B-[100]",productCode:"PD1005",rate:"0.9760",status:"已开启",faceValue:100,productId:"PD1005"},{productName:"产品B-[200]",productCode:"PD1006",rate:"0.9760",status:"已开启",faceValue:200,productId:"PD1006"},{productName:"产品C-[200]",productCode:"PD1007",rate:"0.9760",status:"已开启",faceValue:200,productId:"PD1007"},{productName:"产品C-[100]",productCode:"PD1008",rate:"0.9760",status:"已开启",faceValue:100,productId:"PD1008"}]),y=t(!1),P=l({ipList:""}),S=t(),N=t(!1),C=t({flowType:""}),V=t({currentPage:1,pageSize:10,total:0}),I=t([{id:1,flowType:"余额调整",beforeAmount:"10000.00",amount:5e3,afterAmount:"15000.00",operator:"管理员",type:"手动调整",editTime:"2024-01-15 10:30:00"},{id:2,flowType:"交易增减",beforeAmount:"15000.00",amount:680.5,afterAmount:"15680.50",operator:"系统",type:"ORD20240115001",editTime:"2024-01-15 14:20:00"},{id:3,flowType:"交易增减",beforeAmount:"15680.50",amount:-200,afterAmount:"15480.50",operator:"系统",type:"ORD20240115002",editTime:"2024-01-15 16:45:00"},{id:4,flowType:"余额调整",beforeAmount:"15480.50",amount:200,afterAmount:"15680.50",operator:"管理员",type:"补偿调整",editTime:"2024-01-15 17:10:00"}]),T=a(()=>{let e=I.value;C.value.flowType&&(e=e.filter(e=>e.flowType===C.value.flowType)),V.value.total=e.length;const a=(V.value.currentPage-1)*V.value.pageSize,t=a+V.value.pageSize;return e.slice(a,t)}),x=()=>{P.ipList=_.value.ipWhitelist||"",y.value=!0},te=async()=>{try{await S.value.validate(),h.success("IP白名单设置成功"),y.value=!1,g.merchantInfo||(_.value.ipWhitelist=P.ipList)}catch(e){}},le=()=>{y.value=!1,P.ipList=""},re=()=>{N.value=!1},oe=()=>{V.value.currentPage=1},se=()=>{C.value.flowType="",V.value.currentPage=1},ne=e=>{V.value.pageSize=e,V.value.currentPage=1},ie=e=>{V.value.currentPage=e},de={ipList:[{validator:(e,a,t)=>{if(!a||""===a.trim())return void t(new Error("请输入IP地址"));const l=a.split(",").map(e=>e.trim()).filter(e=>e),r=/^((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/;for(let o of l)if(!r.test(o))return void t(new Error(`IP地址格式不正确: ${o}`));t()},trigger:"blur"}]},ue=async(e,a)=>{try{await navigator.clipboard.writeText(e),h.success(`${a}已复制到剪贴板`)}catch(t){const l=document.createElement("textarea");l.value=e,document.body.appendChild(l),l.select(),document.execCommand("copy"),document.body.removeChild(l),h.success(`${a}已复制到剪贴板`)}};return r(()=>{}),(e,a)=>{const t=o("el-icon"),l=o("el-button"),r=o("el-card"),h=o("el-table-column"),g=o("el-tag"),I=o("el-table"),ce=o("el-option"),pe=o("el-select"),me=o("el-form-item"),fe=o("el-form"),we=o("el-pagination"),ve=o("el-dialog"),he=o("el-input"),ge=o("el-text");return s(),n("div",D,[i(r,{shadow:"never",class:"merchant-info-card"},{default:d(()=>[u("div",A,[u("div",k,[u("div",E,[a[11]||(a[11]=u("span",{class:"label"},"商户号",-1)),u("span",Y,c(_.value.merchantNo),1),i(t,{class:"copy-icon",onClick:a[0]||(a[0]=e=>ue(_.value.merchantNo,"商户号"))},{default:d(()=>[i(p(m))]),_:1})])]),u("div",z,[u("div",O,[a[12]||(a[12]=u("span",{class:"label"},"签名密钥",-1)),u("span",U,c(_.value.signPassword),1),i(t,{class:"copy-icon",onClick:a[1]||(a[1]=e=>ue(_.value.signPassword,"签名密钥"))},{default:d(()=>[i(p(m))]),_:1})])]),u("div",R,[u("div",M,[a[13]||(a[13]=u("span",{class:"label"},"AES密钥",-1)),u("span",$,c(_.value.aesPassword),1),i(t,{class:"copy-icon",onClick:a[2]||(a[2]=e=>ue(_.value.aesPassword,"AES密钥"))},{default:d(()=>[i(p(m))]),_:1})])]),u("div",B,[u("div",H,[a[14]||(a[14]=u("span",{class:"label"},"IP白名单",-1)),u("span",F,c(_.value.ipWhitelist),1)])]),u("div",K,[u("div",L,[a[16]||(a[16]=u("span",{class:"label"},"商户余额",-1)),u("span",W,"¥"+c(_.value.balance||"0.00"),1),i(l,{type:"primary",size:"small",onClick:a[3]||(a[3]=e=>N.value=!0)},{default:d(()=>[...a[15]||(a[15]=[f("余额详情",-1)])]),_:1})])])]),u("div",j,[i(l,{type:"warning",onClick:x},{default:d(()=>[...a[17]||(a[17]=[f("设置IP白名单",-1)])]),_:1})])]),_:1}),i(r,{shadow:"never",class:"product-rate-card"},{default:d(()=>[a[18]||(a[18]=u("div",{class:"card-header"},[u("h3",null,"产品费率：")],-1)),i(I,{data:b.value,border:"",stripe:"",style:{width:"100%"},height:"400"},{default:d(()=>[i(h,{prop:"productName",label:"产品名称","min-width":"200"},{default:d(({row:e})=>[u("span",Q,c(e.productName),1)]),_:1}),i(h,{prop:"productCode",label:"产品编码","min-width":"150"}),i(h,{prop:"rate",label:"费率","min-width":"120",align:"center"},{default:d(({row:e})=>[u("span",q,c(e.rate),1)]),_:1}),i(h,{prop:"status",label:"状态","min-width":"120",align:"center"},{default:d(({row:e})=>[i(g,{type:"success",size:"small"},{default:d(()=>[f(c(e.status),1)]),_:2},1024)]),_:1})]),_:1},8,["data"])]),_:1}),i(ve,{modelValue:N.value,"onUpdate:modelValue":a[8]||(a[8]=e=>N.value=e),title:"余额详情",width:"1000px","before-close":re},{footer:d(()=>[u("span",Z,[i(l,{onClick:a[7]||(a[7]=e=>N.value=!1)},{default:d(()=>[...a[21]||(a[21]=[f("关闭",-1)])]),_:1})])]),default:d(()=>[i(r,{shadow:"never",class:"filter-container"},{default:d(()=>[i(fe,{model:C.value,inline:""},{default:d(()=>[i(me,{label:"流水类型："},{default:d(()=>[i(pe,{modelValue:C.value.flowType,"onUpdate:modelValue":a[4]||(a[4]=e=>C.value.flowType=e),placeholder:"请选择流水类型",clearable:"",style:{width:"168px"}},{default:d(()=>[i(ce,{label:"全部",value:""}),i(ce,{label:"余额调整",value:"余额调整"}),i(ce,{label:"交易增减",value:"交易增减"})]),_:1},8,["modelValue"])]),_:1}),i(me,null,{default:d(()=>[i(l,{type:"primary",onClick:oe},{default:d(()=>[...a[19]||(a[19]=[f("查询",-1)])]),_:1}),i(l,{onClick:se},{default:d(()=>[...a[20]||(a[20]=[f("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),i(I,{data:T.value,border:"",stripe:"",style:{"margin-top":"16px"}},{default:d(()=>[i(h,{prop:"flowType",label:"流水类型",width:"120"}),i(h,{prop:"beforeAmount",label:"交易前金额",width:"120"},{default:d(({row:e})=>[f(" ¥"+c(e.beforeAmount),1)]),_:1}),i(h,{prop:"amount",label:"变动金额",width:"120"},{default:d(({row:e})=>[u("span",{class:w({"positive-amount":e.amount>0,"negative-amount":e.amount<0})},c(e.amount>0?"+":"")+"¥"+c(e.amount),3)]),_:1}),i(h,{prop:"afterAmount",label:"变动后金额",width:"120"},{default:d(({row:e})=>[f(" ¥"+c(e.afterAmount),1)]),_:1}),i(h,{label:"备注","min-width":"200"},{default:d(({row:e})=>["交易增减"===e.flowType?(s(),n("span",G,c(e.amount>0?`锁卡返还余额，单号：${e.type}`:`提卡单号：${e.type}`),1)):(s(),n("span",J,c(e.type),1))]),_:1}),i(h,{prop:"editTime",label:"修改时间",width:"180"})]),_:1},8,["data"]),u("div",X,[i(we,{"current-page":V.value.currentPage,"onUpdate:currentPage":a[5]||(a[5]=e=>V.value.currentPage=e),"page-size":V.value.pageSize,"onUpdate:pageSize":a[6]||(a[6]=e=>V.value.pageSize=e),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next",total:V.value.total,onSizeChange:ne,onCurrentChange:ie},null,8,["current-page","page-size","total"])])]),_:1},8,["modelValue"]),i(ve,{modelValue:y.value,"onUpdate:modelValue":a[10]||(a[10]=e=>y.value=e),title:"设置IP白名单",width:"500px","close-on-click-modal":!1},{footer:d(()=>[u("div",ae,[i(l,{onClick:le},{default:d(()=>[...a[23]||(a[23]=[f("取消",-1)])]),_:1}),i(l,{type:"primary",onClick:te},{default:d(()=>[...a[24]||(a[24]=[f("确认",-1)])]),_:1})])]),default:d(()=>[i(fe,{ref_key:"ipWhitelistFormRef",ref:S,model:P,rules:de,"label-width":"100px","label-position":"top"},{default:d(()=>[i(me,{label:"IP地址列表",prop:"ipList"},{default:d(()=>[i(he,{modelValue:P.ipList,"onUpdate:modelValue":a[9]||(a[9]=e=>P.ipList=e),type:"textarea",rows:6,placeholder:"请输入IP地址，多个IP地址之间用英文逗号(,)分隔\n\n示例：192.168.1.1,192.168.1.2,10.0.0.1",clearable:""},null,8,["modelValue"]),u("div",ee,[i(ge,{type:"info",size:"small"},{default:d(()=>[i(t,null,{default:d(()=>[i(p(v))]),_:1}),a[22]||(a[22]=f(" 多个IP地址之间请用英文逗号(,)分隔，支持IPv4格式 ",-1))]),_:1})])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-049ea8aa"]]),le={class:"page-container"},re={class:"filter-line"},oe={class:"count-text"},se={class:"amount-text"},ne={class:"success-text"},ie={class:"success-amount-text"},de={class:"real-success-text"},ue={class:"real-success-amount-text"},ce={class:"fail-text"},pe={class:"fail-amount-text"},me={class:"processing-text"},fe={class:"processing-amount-text"},we=e({__name:"ProductStatistics",setup(e){const a=l({dateRange:[]}),p=t([{date:"2025-08-27",totalCount:913,totalAmount:"39330",successCount:913,successAmount:"39330",realSuccessCount:"38396.0500",realSuccessAmount:0,failCount:0,failAmount:0,processingCount:0,processingAmount:0}]),m=t(!1),w=()=>{m.value=!0,setTimeout(()=>{m.value=!1,h.success("查询完成")},1e3)},v=()=>{const e=new Date,t=new Date(e.getFullYear(),e.getMonth(),e.getDate(),0,0,0),l=new Date(e.getFullYear(),e.getMonth(),e.getDate(),23,59,59);a.dateRange=[t.toISOString().slice(0,19).replace("T"," "),l.toISOString().slice(0,19).replace("T"," ")],w()},y=()=>{const e=new Date;e.setDate(e.getDate()-1);const t=new Date(e.getFullYear(),e.getMonth(),e.getDate(),0,0,0),l=new Date(e.getFullYear(),e.getMonth(),e.getDate(),23,59,59);a.dateRange=[t.toISOString().slice(0,19).replace("T"," "),l.toISOString().slice(0,19).replace("T"," ")],w()},P=()=>{const e=new Date,t=new Date;t.setDate(e.getDate()-7);const l=new Date(t.getFullYear(),t.getMonth(),t.getDate(),0,0,0),r=new Date(e.getFullYear(),e.getMonth(),e.getDate(),23,59,59);a.dateRange=[l.toISOString().slice(0,19).replace("T"," "),r.toISOString().slice(0,19).replace("T"," ")],w()};return r(()=>{v()}),(e,t)=>{const l=o("el-date-picker"),r=o("el-form-item"),h=o("el-button"),S=o("el-form"),N=o("el-card"),C=o("el-table-column"),V=o("el-table"),I=g("loading");return s(),n("div",le,[i(N,{class:"filter-container",shadow:"never"},{default:d(()=>[i(S,{model:a,inline:"",class:"multi-line-filter-form"},{default:d(()=>[u("div",re,[i(r,{label:"日期时间：",prop:"dateRange"},{default:d(()=>[i(l,{modelValue:a.dateRange,"onUpdate:modelValue":t[0]||(t[0]=e=>a.dateRange=e),type:"datetimerange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"350px"}},null,8,["modelValue"])]),_:1}),i(r,null,{default:d(()=>[i(h,{type:"primary",onClick:w},{default:d(()=>[...t[1]||(t[1]=[f("查询",-1)])]),_:1}),i(h,{onClick:v},{default:d(()=>[...t[2]||(t[2]=[f("今天",-1)])]),_:1}),i(h,{onClick:y},{default:d(()=>[...t[3]||(t[3]=[f("昨天",-1)])]),_:1}),i(h,{onClick:P},{default:d(()=>[...t[4]||(t[4]=[f("最近7天",-1)])]),_:1})]),_:1})])]),_:1},8,["model"])]),_:1}),i(N,{shadow:"never",class:"table-card"},{default:d(()=>[t[5]||(t[5]=u("div",{class:"card-header"},[u("h3",null,"产品统计")],-1)),_((s(),b(V,{data:p.value,border:"",stripe:"",class:"statistics-table"},{default:d(()=>[i(C,{prop:"date",label:"统计日期","min-width":"120",align:"center"}),i(C,{prop:"totalCount",label:"总笔数","min-width":"100",align:"center"},{default:d(({row:e})=>[u("span",oe,c(e.totalCount),1)]),_:1}),i(C,{prop:"totalAmount",label:"总金额","min-width":"120",align:"center"},{default:d(({row:e})=>[u("span",se,c(e.totalAmount),1)]),_:1}),i(C,{prop:"successCount",label:"成功笔数","min-width":"100",align:"center"},{default:d(({row:e})=>[u("span",ne,c(e.successCount),1)]),_:1}),i(C,{prop:"successAmount",label:"成功金额","min-width":"120",align:"center"},{default:d(({row:e})=>[u("span",ie,c(e.successAmount),1)]),_:1}),i(C,{prop:"realSuccessCount",label:"实际成功笔数","min-width":"120",align:"center"},{default:d(({row:e})=>[u("span",de,c(e.realSuccessCount),1)]),_:1}),i(C,{prop:"realSuccessAmount",label:"实际成功金额","min-width":"120",align:"center"},{default:d(({row:e})=>[u("span",ue,c(e.realSuccessAmount),1)]),_:1}),i(C,{prop:"failCount",label:"失败笔数","min-width":"100",align:"center"},{default:d(({row:e})=>[u("span",ce,c(e.failCount),1)]),_:1}),i(C,{prop:"failAmount",label:"失败金额","min-width":"120",align:"center"},{default:d(({row:e})=>[u("span",pe,c(e.failAmount),1)]),_:1}),i(C,{prop:"processingCount",label:"处理中笔数","min-width":"120",align:"center"},{default:d(({row:e})=>[u("span",me,c(e.processingCount),1)]),_:1}),i(C,{prop:"processingAmount",label:"处理中金额","min-width":"120",align:"center"},{default:d(({row:e})=>[u("span",fe,c(e.processingAmount),1)]),_:1})]),_:1},8,["data"])),[[I,m.value]])]),_:1})])}}},[["__scopeId","data-v-0fc711ea"]]),ve={class:"page-container"},he={class:"filter-line"},ge={class:"filter-line"},_e={class:"filter-line"},be={class:"filter-line"},ye={class:"filter-buttons"},Pe={class:"table-toolbar"},Se={class:"toolbar-left"},Ne={class:"toolbar-right"},Ce={class:"order-info"},Ve={class:"order-id"},Ie={class:"system-id"},Te={class:"card-info"},xe={class:"card-number"},De={class:"card-password"},Ae={class:"pagination-container"},ke=e({__name:"WithdrawalRecords",setup(e){const m=l({orderNo:"",productName:"",transactionStatus:"",verificationStatus:"",withdrawalTime:[],merchantOrderNo:"",systemOrderNo:"",faceValue:"",cardNo:""}),w=t([]),v=t(!1),S=t([]),N=a(()=>S.value.filter(e=>"unverified"===e.verificationStatus).length),C=a(()=>S.value.filter(e=>"locked"===e.verificationStatus).length),V=a(()=>S.value.length>0&&S.value.every(e=>"unverified"===e.verificationStatus)),I=a(()=>S.value.length>0&&S.value.every(e=>"locked"===e.verificationStatus)),T=l({currentPage:1,pageSize:20,total:0}),x=[{id:1,orderNo:"B1720300348648058428",systemId:"2024073651326773609",productName:"联通充值卡 【10元】",faceValue:"10",cardNumber:"626816800002319902",cardPassword:"••••••••1020",transactionAmount:"29.28",transactionQuantity:1,transactionStatus:"success",withdrawalTime:"2025-06-27 21:16:26",verificationStatus:"verified",withdrawalTimestamp:"1719504986000"},{id:2,orderNo:"B1720300379060721406",systemId:"2024073651326907464",productName:"移动充值卡 【20元】",faceValue:"20",cardNumber:"654688700000616170",cardPassword:"••••••••9934",transactionAmount:"19.52",transactionQuantity:1,transactionStatus:"success",withdrawalTime:"2025-06-27 21:16:19",verificationStatus:"unverified",withdrawalTimestamp:"1719504979000"},{id:3,orderNo:"B1720300352624312456",systemId:"2024073651327704814",productName:"电信充值卡 【30元】",faceValue:"30",cardNumber:"654683000137951548",cardPassword:"••••••••7823",transactionAmount:"29.28",transactionQuantity:1,transactionStatus:"processing",withdrawalTime:"2025-06-27 21:15:52",verificationStatus:"locked",withdrawalTimestamp:"1719504952000"},{id:4,orderNo:"B1720300342476025715",systemId:"2024073651326876567",productName:"联通充值卡 【20元】",faceValue:"20",cardNumber:"626816800002319903",cardPassword:"••••••••2031",transactionAmount:"29.28",transactionQuantity:1,transactionStatus:"failed",withdrawalTime:"2025-06-27 21:14:54",verificationStatus:"unverified",withdrawalTimestamp:"1719504894000"},{id:5,orderNo:"B1720300348367603714",systemId:"V1720300316764341412",productName:"移动充值卡 【20元】",faceValue:"20",cardNumber:"654688700000616171",cardPassword:"••••••••4567",transactionAmount:"29.28",transactionQuantity:1,transactionStatus:"success",withdrawalTime:"2025-06-27 21:14:48",verificationStatus:"verified",withdrawalTimestamp:"1719504888000"}],D=e=>({success:"处理成功",processing:"处理中",failed:"处理失败"}[e]||"未知状态"),A=e=>({verified:"已核销",unverified:"未核销",locked:"已锁定"}[e]||"未知状态"),k=e=>{if(!e)return"-";return new Date(parseInt(e)).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})},E=async(e=null)=>{v.value=!0;try{await new Promise(e=>setTimeout(e,500));let a=[...x];e&&(e.cardNumbers&&e.cardNumbers.length>0&&(a=a.filter(a=>e.cardNumbers.some(e=>a.cardNumber.includes(e)))),e.orderNo&&(a=a.filter(a=>a.orderNo.includes(e.orderNo))),e.productName&&(a=a.filter(a=>a.productName.includes(e.productName))),e.transactionStatus&&(a=a.filter(a=>a.transactionStatus===e.transactionStatus)),e.verificationStatus&&(a=a.filter(a=>a.verificationStatus===e.verificationStatus)),e.merchantOrderNo&&(a=a.filter(a=>a.orderNo.includes(e.merchantOrderNo))),e.systemOrderNo&&(a=a.filter(a=>a.systemId.includes(e.systemOrderNo))),e.faceValue&&(a=a.filter(a=>a.faceValue===e.faceValue))),w.value=a,T.total=a.length}catch(a){h.error("加载数据失败")}finally{v.value=!1}},Y=()=>{let e=[];m.cardNo&&m.cardNo.trim()&&(e=m.cardNo.split("\n").map(e=>e.trim()).filter(e=>e.length>0));const a={...m,cardNumbers:e};E(a)},z=()=>{Object.keys(m).forEach(e=>{Array.isArray(m[e])?m[e]=[]:m[e]=""}),E()},O=()=>{E()},U=e=>{S.value=e},R=async()=>{if(!V.value)return void h.warning("请选择未核销状态的记录进行锁定");const e=S.value.filter(e=>"unverified"===e.verificationStatus);try{await P.confirm(`确认锁定选中的 ${e.length} 条记录？`,"锁卡确认",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}),await new Promise(e=>setTimeout(e,1e3)),e.forEach(e=>{e.verificationStatus="locked"}),h.success(`成功锁定 ${e.length} 条记录`)}catch(a){"cancel"!==a&&h.error("锁卡操作失败")}},M=async()=>{if(!I.value)return void h.warning("请选择已锁定状态的记录进行解锁");const e=S.value.filter(e=>"locked"===e.verificationStatus);try{await P.confirm(`确认解锁选中的 ${e.length} 条记录？`,"解锁确认",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}),await new Promise(e=>setTimeout(e,1e3)),e.forEach(e=>{e.verificationStatus="unverified"}),h.success(`成功解锁 ${e.length} 条记录`)}catch(a){"cancel"!==a&&h.error("解锁操作失败")}},$=e=>{T.pageSize=e,T.currentPage=1,E()},B=e=>{T.currentPage=e,E()};return r(()=>{E()}),(e,a)=>{const t=o("el-input"),l=o("el-form-item"),r=o("el-option"),S=o("el-select"),x=o("el-date-picker"),E=o("el-button"),H=o("el-form"),F=o("el-card"),K=o("el-table-column"),L=o("el-tag"),W=o("el-switch"),j=o("el-table"),Q=o("el-pagination"),q=g("loading");return s(),n("div",ve,[i(F,{class:"filter-container",shadow:"never"},{default:d(()=>[i(H,{model:m,inline:"",class:"multi-line-filter-form"},{default:d(()=>[u("div",he,[i(l,{label:"订单号：",prop:"orderNo"},{default:d(()=>[i(t,{modelValue:m.orderNo,"onUpdate:modelValue":a[0]||(a[0]=e=>m.orderNo=e),placeholder:"请输入订单号",clearable:"",style:{width:"220px"}},null,8,["modelValue"])]),_:1}),i(l,{label:"产品：",prop:"productName"},{default:d(()=>[i(t,{modelValue:m.productName,"onUpdate:modelValue":a[1]||(a[1]=e=>m.productName=e),placeholder:"请输入产品名称",clearable:"",style:{width:"168px"}},null,8,["modelValue"])]),_:1}),i(l,{label:"交易状态：",prop:"transactionStatus"},{default:d(()=>[i(S,{modelValue:m.transactionStatus,"onUpdate:modelValue":a[2]||(a[2]=e=>m.transactionStatus=e),placeholder:"请选择交易状态",clearable:"",style:{width:"168px"}},{default:d(()=>[i(r,{label:"处理成功",value:"success"}),i(r,{label:"处理中",value:"processing"}),i(r,{label:"处理失败",value:"failed"})]),_:1},8,["modelValue"])]),_:1})]),u("div",ge,[i(l,{label:"核销状态：",prop:"verificationStatus"},{default:d(()=>[i(S,{modelValue:m.verificationStatus,"onUpdate:modelValue":a[3]||(a[3]=e=>m.verificationStatus=e),placeholder:"请选择核销状态",clearable:"",style:{width:"168px"}},{default:d(()=>[i(r,{label:"已核销",value:"verified"}),i(r,{label:"未核销",value:"unverified"}),i(r,{label:"已锁定",value:"locked"})]),_:1},8,["modelValue"])]),_:1}),i(l,{label:"提卡时间：",prop:"withdrawalTime"},{default:d(()=>[i(x,{modelValue:m.withdrawalTime,"onUpdate:modelValue":a[4]||(a[4]=e=>m.withdrawalTime=e),type:"datetimerange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"350px"}},null,8,["modelValue"])]),_:1})]),u("div",_e,[i(l,{label:"商户单号：",prop:"merchantOrderNo"},{default:d(()=>[i(t,{modelValue:m.merchantOrderNo,"onUpdate:modelValue":a[5]||(a[5]=e=>m.merchantOrderNo=e),placeholder:"请输入商户单号",clearable:"",style:{width:"220px"}},null,8,["modelValue"])]),_:1}),i(l,{label:"系统单号：",prop:"systemOrderNo"},{default:d(()=>[i(t,{modelValue:m.systemOrderNo,"onUpdate:modelValue":a[6]||(a[6]=e=>m.systemOrderNo=e),placeholder:"请输入系统单号",clearable:"",style:{width:"220px"}},null,8,["modelValue"])]),_:1})]),u("div",be,[i(l,{label:"面值：",prop:"faceValue"},{default:d(()=>[i(S,{modelValue:m.faceValue,"onUpdate:modelValue":a[7]||(a[7]=e=>m.faceValue=e),placeholder:"请选择面值",clearable:"",style:{width:"168px"}},{default:d(()=>[i(r,{label:"10元",value:"10"}),i(r,{label:"20元",value:"20"}),i(r,{label:"30元",value:"30"}),i(r,{label:"50元",value:"50"}),i(r,{label:"100元",value:"100"}),i(r,{label:"200元",value:"200"}),i(r,{label:"300元",value:"300"})]),_:1},8,["modelValue"])]),_:1}),i(l,{label:"卡号：",prop:"cardNo"},{default:d(()=>[i(t,{modelValue:m.cardNo,"onUpdate:modelValue":a[8]||(a[8]=e=>m.cardNo=e),type:"textarea",rows:3,maxlength:1e3,placeholder:"请输入卡号，多个卡号请换行分隔",clearable:"",style:{width:"220px"},resize:"none"},null,8,["modelValue"])]),_:1}),u("div",ye,[i(E,{type:"primary",onClick:Y},{default:d(()=>[...a[11]||(a[11]=[f("查询",-1)])]),_:1}),i(E,{plain:"",onClick:z},{default:d(()=>[...a[12]||(a[12]=[f("重置",-1)])]),_:1})])])]),_:1},8,["model"])]),_:1}),i(F,{class:"table-container",shadow:"never"},{default:d(()=>[u("div",Pe,[u("div",Se,[i(E,{type:"warning",disabled:!V.value,onClick:R},{default:d(()=>[f(" 锁卡"+c(N.value>0?`(${N.value})`:""),1)]),_:1},8,["disabled"]),i(E,{type:"success",disabled:!I.value,onClick:M},{default:d(()=>[f(" 解锁"+c(C.value>0?`(${C.value})`:""),1)]),_:1},8,["disabled"])]),u("div",Ne,[i(E,{icon:p(y),onClick:O},{default:d(()=>[...a[13]||(a[13]=[f("刷新",-1)])]),_:1},8,["icon"])])]),_((s(),b(j,{data:w.value,border:"",stripe:"",style:{"margin-top":"16px"},onSelectionChange:U},{default:d(()=>[i(K,{type:"selection",width:"55"}),i(K,{prop:"orderNo",label:"订单号","min-width":"180"},{default:d(({row:e})=>[u("div",Ce,[u("div",Ve,c(e.orderNo),1),u("div",Ie,c(e.systemId),1)])]),_:1}),i(K,{prop:"productName",label:"产品","min-width":"150"},{default:d(({row:e,$index:a})=>[u("span",null,"产品"+c(String.fromCharCode(65+a))+"-["+c(e.faceValue)+"]",1)]),_:1}),i(K,{prop:"cardInfo",label:"卡密","min-width":"200"},{default:d(({row:e})=>[u("div",Te,[u("div",xe,c(e.cardNumber),1),u("div",De,c(e.cardPassword),1)])]),_:1}),i(K,{prop:"transactionAmount",label:"交易金额","min-width":"100"},{default:d(({row:e})=>[f(" ¥"+c(e.transactionAmount),1)]),_:1}),i(K,{prop:"transactionQuantity",label:"交易数量","min-width":"100"}),i(K,{prop:"transactionStatus",label:"交易状态","min-width":"120"},{default:d(({row:e})=>{return[i(L,{type:(a=e.transactionStatus,{success:"success",processing:"warning",failed:"danger"}[a]||"info"),size:"small"},{default:d(()=>[f(c(D(e.transactionStatus)),1)]),_:2},1032,["type"])];var a}),_:1}),i(K,{prop:"withdrawalTime",label:"提卡时间","min-width":"160"}),i(K,{prop:"verificationStatus",label:"核销状态","min-width":"120"},{default:d(({row:e})=>{return[i(L,{type:(a=e.verificationStatus,{verified:"success",unverified:"warning",locked:"danger"}[a]||"info"),size:"small"},{default:d(()=>[f(c(A(e.verificationStatus)),1)]),_:2},1032,["type"])];var a}),_:1}),i(K,{label:"锁卡开关","min-width":"100",align:"center",fixed:"right"},{default:d(({row:e})=>[i(W,{"model-value":"locked"===e.verificationStatus,disabled:"verified"===e.verificationStatus,onChange:a=>(async(e,a)=>{const t=a?"锁定":"解锁",l=`确认${t}该卡密？`;try{await P.confirm(l,`${t}确认`,{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}),await new Promise(e=>setTimeout(e,500)),e.verificationStatus=a?"locked":"unverified",h.success(`${t}成功`)}catch(r){"cancel"!==r&&h.error(`${t}操作失败`)}})(e,a),"active-text":"","inactive-text":"","active-color":"verified"===e.verificationStatus?"#C0C4CC":"#13CE66","inactive-color":"verified"===e.verificationStatus?"#C0C4CC":"#DCDFE6"},null,8,["model-value","disabled","onChange","active-color","inactive-color"])]),_:1}),i(K,{prop:"withdrawalTimestamp",label:"核销时间","min-width":"180"},{default:d(({row:e})=>[f(c(k(e.withdrawalTimestamp)),1)]),_:1})]),_:1},8,["data"])),[[q,v.value]]),u("div",Ae,[i(Q,{"current-page":T.currentPage,"onUpdate:currentPage":a[9]||(a[9]=e=>T.currentPage=e),"page-size":T.pageSize,"onUpdate:pageSize":a[10]||(a[10]=e=>T.pageSize=e),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:T.total,onSizeChange:$,onCurrentChange:B},null,8,["current-page","page-size","total"])])]),_:1})])}}},[["__scopeId","data-v-41b7a15e"]]),Ee={class:"reset-password"},Ye={class:"form-container"},ze=e({__name:"ResetPassword",setup(e){const a=t(),r=t(!1),c=l({currentPassword:"",newPassword:"",confirmPassword:""}),p={currentPassword:[{required:!0,message:"请输入当前密码",trigger:"blur"}],newPassword:[{required:!0,validator:(e,t,l)=>{""===t?l(new Error("请输入新密码")):t.length<6?l(new Error("密码长度不能少于6位")):t===c.currentPassword?l(new Error("新密码不能与当前密码相同")):(""!==c.confirmPassword&&a.value.validateField("confirmPassword"),l())},trigger:"blur"}],confirmPassword:[{required:!0,validator:(e,a,t)=>{""===a?t(new Error("请再次输入新密码")):a!==c.newPassword?t(new Error("两次输入密码不一致")):t()},trigger:"blur"}]},m=async()=>{try{await a.value.validate(),r.value=!0,await new Promise(e=>setTimeout(e,1e3)),h.success("密码修改成功"),w()}catch(e){}finally{r.value=!1}},w=()=>{var e;null==(e=a.value)||e.resetFields(),Object.assign(c,{currentPassword:"",newPassword:"",confirmPassword:""})};return(e,t)=>{const l=o("el-input"),v=o("el-form-item"),h=o("el-button"),g=o("el-space"),_=o("el-form"),b=o("el-card");return s(),n("div",Ee,[u("div",Ye,[i(b,{class:"form-card"},{default:d(()=>[i(_,{ref_key:"passwordFormRef",ref:a,model:c,rules:p,"label-width":"100px"},{default:d(()=>[i(v,{label:"当前密码",prop:"currentPassword"},{default:d(()=>[i(l,{modelValue:c.currentPassword,"onUpdate:modelValue":t[0]||(t[0]=e=>c.currentPassword=e),type:"password",placeholder:"请输入当前密码","show-password":""},null,8,["modelValue"])]),_:1}),i(v,{label:"新密码",prop:"newPassword"},{default:d(()=>[i(l,{modelValue:c.newPassword,"onUpdate:modelValue":t[1]||(t[1]=e=>c.newPassword=e),type:"password",placeholder:"请输入新密码","show-password":""},null,8,["modelValue"])]),_:1}),i(v,{label:"确认新密码",prop:"confirmPassword"},{default:d(()=>[i(l,{modelValue:c.confirmPassword,"onUpdate:modelValue":t[2]||(t[2]=e=>c.confirmPassword=e),type:"password",placeholder:"请再次输入新密码","show-password":""},null,8,["modelValue"])]),_:1}),i(v,null,{default:d(()=>[i(g,null,{default:d(()=>[i(h,{type:"primary",loading:r.value,onClick:m},{default:d(()=>[...t[3]||(t[3]=[f(" 保存 ",-1)])]),_:1},8,["loading"]),i(h,{onClick:w},{default:d(()=>[...t[4]||(t[4]=[f("重置",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})])])}}},[["__scopeId","data-v-d14f508e"]]),Oe={class:"header-left"},Ue={class:"page-title"},Re={class:"toolbar"},Me={class:"user-info"},$e={class:"user-nickname"},Be=e({__name:"MerchantDashboard",setup(e){const l=t({merchantNo:"",merchantKey:"",customerName:"",customerId:""});r(()=>{const e=new URLSearchParams(window.location.search),a=e.get("merchantNo"),t=e.get("merchantKey"),r=e.get("customerName"),o=e.get("customerId");a&&t&&r&&o?(l.value={merchantNo:a,merchantKey:t,customerName:r,customerId:o},h.success(`欢迎进入商户后台系统，${r}`)):(l.value={merchantNo:"MERCHANT001",merchantKey:"KEY001",customerName:"测试商户",customerId:"001"},h.success("欢迎进入商户后台系统"))});const n=t("product-management"),m=S(te),f={"product-management":te,"order-management":we,"withdrawal-records":ke,"reset-password":ze},w={"product-management":"产品管理","order-management":"产品统计","balance-management":"余额管理","withdrawal-records":"提卡记录","reset-password":"重置密码","api-docs":"API文档","account-settings":"账户设置","security-settings":"安全设置"},v=a(()=>w[n.value]||"商户后台"),g=e=>{f[e]?(n.value=e,m.value=f[e]):h.info(`${w[e]||"该功能"}正在开发中...`)},_=e=>{switch(e){case"profile":h.info("个人资料功能开发中...");break;case"reset-password":n.value="reset-password",m.value=ze;break;case"logout":h.success("退出登录成功")}};return(e,a)=>{const t=o("el-icon"),r=o("el-menu-item"),f=o("el-menu"),w=o("el-scrollbar"),h=o("el-aside"),y=o("el-avatar"),P=o("el-dropdown-item"),S=o("el-dropdown-menu"),D=o("el-dropdown"),A=o("el-header"),k=o("el-main"),E=o("el-container");return s(),b(E,{class:"merchant-layout-container"},{default:d(()=>[i(h,{width:"200px",class:"merchant-layout-aside"},{default:d(()=>[a[4]||(a[4]=u("div",{class:"merchant-layout-logo"},[u("span",null,"商户后台")],-1)),i(w,null,{default:d(()=>[i(f,{"default-active":n.value,onSelect:g},{default:d(()=>[i(r,{index:"product-management"},{default:d(()=>[i(t,null,{default:d(()=>[i(p(N))]),_:1}),a[0]||(a[0]=u("span",null,"产品管理",-1))]),_:1}),i(r,{index:"order-management"},{default:d(()=>[i(t,null,{default:d(()=>[i(p(C))]),_:1}),a[1]||(a[1]=u("span",null,"产品统计",-1))]),_:1}),i(r,{index:"withdrawal-records"},{default:d(()=>[i(t,null,{default:d(()=>[i(p(V))]),_:1}),a[2]||(a[2]=u("span",null,"提卡记录",-1))]),_:1}),i(r,{index:"reset-password"},{default:d(()=>[i(t,null,{default:d(()=>[i(p(I))]),_:1}),a[3]||(a[3]=u("span",null,"重置密码",-1))]),_:1})]),_:1},8,["default-active"])]),_:1})]),_:1}),i(E,null,{default:d(()=>[i(A,{class:"merchant-layout-header"},{default:d(()=>[u("div",Oe,[u("span",Ue,c(v.value),1)]),u("div",Re,[i(D,{onCommand:_},{dropdown:d(()=>[i(S,null,{default:d(()=>[i(P,{command:"reset-password"},{default:d(()=>[i(t,null,{default:d(()=>[i(p(I))]),_:1}),a[5]||(a[5]=u("span",null,"修改密码",-1))]),_:1}),i(P,{command:"logout",divided:""},{default:d(()=>[i(t,null,{default:d(()=>[i(p(T))]),_:1}),a[6]||(a[6]=u("span",null,"退出登录",-1))]),_:1})]),_:1})]),default:d(()=>[u("div",Me,[i(y,{size:32,icon:"User",class:"user-avatar"}),u("span",$e,c(l.value.customerName),1)])]),_:1})])]),_:1}),i(k,{class:"merchant-layout-main"},{default:d(()=>[i(w,null,{default:d(()=>[(s(),b(x(m.value),{"merchant-info":l.value},null,8,["merchant-info"]))]),_:1})]),_:1})]),_:1})]),_:1})}}},[["__scopeId","data-v-f770a7c9"]]);export{Be as M,ze as R};
